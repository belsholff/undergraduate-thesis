#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass ../../../../Documentos/UFES/PG/undergraduate-thesis/thesis/lyx/abntex2
\begin_preamble
% ---
% PACOTES
% ---
\usepackage{lastpage}			% Usado pela Ficha catalográfica
\usepackage{indentfirst}			% Indenta o primeiro parágrafo de cada seção.
\usepackage{color}			% Controle das cores
\RequirePackage{url}			% deve ser carregado para tratar url de forma correta e usado pelo abntex2cite
\RequirePackage{breakurl}			% trata de forma correta a quebra de url entre linhas
% ---
% Pacotes de citações
% ---
\usepackage[brazilian,hyperpageref]{backref}	 % Paginas com as citações na bibl
\usepackage[num,abnt-url-package=url
  ]{abntex2cite}	% Citações padrão ABNT
% O carregamento da opção abnt-url-package=url corrige os hiperlinks com quebra de linha na bibliografia
%\bibliographystyle{unsrt}
% --- 
% CONFIGURAÇÕES DE PACOTES
% --- 

% ---
% Configurações do pacote backref
% Usado sem a opção hyperpageref de backref
\renewcommand{\backrefpagesname}{Citado na(s) página(s):~}
% Texto padrão antes do número das páginas
\renewcommand{\backref}{}
% Define os textos da citação
\renewcommand*{\backrefalt}[4]{
\ifcase #1
Nenhuma citação no texto.
\or
Citado na página #2.
\else
Citado #1 vezes nas páginas #2.
\fi}

% --- 
% Espaçamentos entre linhas e parágrafos 
% --- 

% O tamanho do parágrafo é dado por:
\setlength{\parindent}{1.3cm}

% Controle do espaçamento entre um parágrafo e outro:
\setlength{\parskip}{0.2cm}  % tente também \onelineskip

% ---
% Configurações de aparência do PDF final

% alterando o aspecto da cor azul
\definecolor{blue}{RGB}{41,5,195}

% informações do PDF
\hypersetup{
    unicode=true,
    backref=true,
    pagebackref=true,
    bookmarks=true,         		% show bookmarks bar?
%	    pdftitle={\titulocompleto}, 
%	    pdfauthor={\nomecompletoautor},
%	    pdfsubject={\imprimirpreambulo},
%	    pdfkeywords={\palavrachaveum}{\palavrachavedois}{\palavrachavetres},
    pdfproducer={LaTeX with abnTeX2}, 	% producer of the document
%	    pdfcreator={\nomecompletoautor},
    colorlinks=true,       		% false: boxed links; true: colored links
    linkcolor=blue,          	        % color of internal links
    citecolor=blue,        		% color of links to bibliography
    filecolor=magenta,      		% color of file links
    urlcolor=blue,			% color of url links
    bookmarksdepth=4,
    breaklinks=true			% deve ser usado com o pacote breakurl, sem ele não fuciona
}

% ---
% compila o indice
% ---
\makeindex
% ---
\end_preamble
\options 12pt,openright,twoside,a4paper,brazil,portuguese
\use_default_options false
\maintain_unincluded_children false
\language brazilian
\language_package default
\inputencoding utf8
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command bibtex
\index_command default
\float_placement H
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style unsrt
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Titulo
Implementação de Funções de Rede Virtuais usando ClickOS
\end_layout

\begin_layout Local
Vitória, Espírito Santo, Brasil
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
instituicao{Universidade Federal do Espírito Santo - UFES
\backslash
par
\end_layout

\begin_layout Plain Layout

Centro Tecnológico - CT
\backslash
par Graduação em Ciência da Computação}
\end_layout

\end_inset


\end_layout

\begin_layout Data
Julho 2018
\end_layout

\begin_layout Preambulo
Projeto final de graduação apresentado ao Departamento de Informática do
 Centro Técnológico da Universidade Federal do Espírito Santo, como requisito
 parcial para obter o título de Bacharel em Ciência da Computação
\end_layout

\begin_layout Autor
Felipe Belsholff Pina
\end_layout

\begin_layout Orientador
Prof.
 Dr.
 Rodolfo da Silva Villaça
\end_layout

\begin_layout Co-Orientador
Prof.
 Dr.
 Magnos Martinello
\end_layout

\begin_layout Tipo-trabalho
Tese de Conclusão de Curso
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

%
\backslash
let
\backslash
ref
\backslash
autoref
\end_layout

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Veja 
\begin_inset Flex URL
status open

\begin_layout Plain Layout

http://tex.stackexchange.com/questions/6059/table-figure-and-listing-prefixes
\end_layout

\end_inset

 para uma explicação.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
frenchspacing
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
pretextual
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imprimircapa
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
imprimirfolhaderosto*{}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Ficha catalográfica entra aqui, se necessária.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Errata seguirá aqui, se necessária.
\end_layout

\end_inset


\end_layout

\begin_layout Folha de Aprovacao
\begin_inset ERT
status open

\begin_layout Plain Layout

	
\backslash
begin{center}     
\end_layout

\begin_layout Plain Layout

			{
\backslash
ABNTEXchapterfont
\backslash
large
\backslash
imprimirautor}
\end_layout

\begin_layout Plain Layout

		
\end_layout

\begin_layout Plain Layout

		
\backslash
vspace*{
\backslash
fill}
\backslash
vspace*{
\backslash
fill}
\end_layout

\begin_layout Plain Layout

		
\backslash
begin{center}       
\end_layout

\begin_layout Plain Layout

			
\backslash
ABNTEXchapterfont
\backslash
bfseries
\backslash
Large
\backslash
imprimirtitulo     
\end_layout

\begin_layout Plain Layout

		
\backslash
end{center}     
\end_layout

\begin_layout Plain Layout

		
\backslash
vspace*{
\backslash
fill}          
\end_layout

\begin_layout Plain Layout

		
\end_layout

\begin_layout Plain Layout

		
\backslash
hspace{.45
\backslash
textwidth}     
\end_layout

\begin_layout Plain Layout

		
\backslash
begin{minipage}{.5
\backslash
textwidth}         
\end_layout

\begin_layout Plain Layout

			
\backslash
imprimirpreambulo     
\end_layout

\begin_layout Plain Layout

		
\backslash
end{minipage}%     
\end_layout

\begin_layout Plain Layout

		
\backslash
vspace*{
\backslash
fill}    
\end_layout

\begin_layout Plain Layout

	
\backslash
end{center}             
\end_layout

\begin_layout Plain Layout

	Trabalho aprovado.
 
\backslash
imprimirlocal, 13 de julho de 2018:
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	
\backslash
assinatura{
\backslash
textbf{
\backslash
imprimirorientador} 
\backslash

\backslash
 Orientador}	
\end_layout

\begin_layout Plain Layout

	
\backslash
assinatura{
\backslash
textbf{
\backslash
imprimircoorientador} 
\backslash

\backslash
 Co-orientador}     	
\end_layout

\begin_layout Plain Layout

	
\backslash
assinatura{
\backslash
textbf{Professor} 
\backslash

\backslash
 Convidado Interno}
\end_layout

\begin_layout Plain Layout

	
\backslash
assinatura{
\backslash
textbf{Profa.
 Dra.
 Cristina Klippel Dominicini} 
\backslash

\backslash
 Convidado Externo}
\end_layout

\begin_layout Plain Layout

	
\end_layout

\begin_layout Plain Layout

	
\backslash
begin{center}     
\end_layout

\begin_layout Plain Layout

		
\backslash
vspace*{0.5cm}     
\end_layout

\begin_layout Plain Layout

		{
\backslash
large
\backslash
imprimirlocal}     
\end_layout

\begin_layout Plain Layout

		
\backslash
par 
\end_layout

\begin_layout Plain Layout

		{
\backslash
large
\backslash
imprimirdata}     
\end_layout

\begin_layout Plain Layout

		
\backslash
vspace*{1cm}   
\end_layout

\begin_layout Plain Layout

	
\backslash
end{center}    
\end_layout

\end_inset


\end_layout

\begin_layout Dedicatoria
\align center
\begin_inset VSpace vfill*
\end_inset


\end_layout

\begin_layout Dedicatoria
\align center

\shape italic
Em memória de Leonina, e dedicado àqueles que diante das
\begin_inset Newline newline
\end_inset

 negativas do mundo, contrariaram-no na busca pelo sim.
\end_layout

\begin_layout Dedicatoria
\begin_inset VSpace vfill*
\end_inset


\end_layout

\begin_layout Agradecimentos
A
\end_layout

\begin_layout Epigrafe
\align right
\begin_inset VSpace vfill*
\end_inset


\end_layout

\begin_layout Epigrafe
\paragraph_spacing single
\align right

\shape italic
\begin_inset Quotes eld
\end_inset

Você toma a pílula azul — a história acaba, e
\begin_inset Newline newline
\end_inset

você acorda em sua cama acreditando no que
\begin_inset Newline newline
\end_inset

quiser acreditar.
 Você toma a pílula vermelha —
\begin_inset Newline newline
\end_inset

 fica no País da Maravilhas, e lhe mostro quão
\begin_inset Newline newline
\end_inset

fundo a toca do coelho vai.
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Epigrafe
\align right
(Morpheus, The Matrix)
\end_layout

\begin_layout Resumo
Com o advento da virtualização e o surgimento do modelo de computação em
 nuvem (
\shape italic
Cloud Computing
\shape default
), uma das consequências imediatas para as empresas e instituições foi a
 redução da aquisição de novos equipamentos.
 Além disso, ainda no ponto de vista de infraestrutura, desacoplar funções
 que estavam embarcadas em hardware específico e fechado, trazendo-as até
 camadas de abstração superiores, habilita um menor tempo de implantação
 e de manutenção, acrescido de um grande salto com relação a escalabilidade
 e gerenciamento das mesmas.
\end_layout

\begin_layout Resumo
Neste cenário, o objetivo do paradigma NFV é prover funções de rede como:
 
\shape italic
firewalls
\shape default
, balanceadores de carga, NATs, e IDSs, etc, através de uma linguagem de
 marcação, colaborando com a flexibilidade do provisionamento e a programabilida
de de tais funções, até então também engessadas pelo uso dos 
\shape italic
middleboxes
\shape default
 de prateleira.
\end_layout

\begin_layout Resumo
Neste quesito, ClickOS propõe uma plataforma de virtualização para criação
 de funções de rede virtuais de alto desempenho, a serem amplamente utilizados
 por desenvolvedores de VNFs.
 Ele provê como ferramenta uma máquina virtual minimalista, escalável e
 otimizada para executar o 
\shape italic
software
\shape default
 Click no 
\shape italic
hypervisor
\shape default
 do Projeto Xen, seguido de uma sequência de otimizações focadas na vazão
 de pacotes.
\end_layout

\begin_layout Resumo
No entanto, a pouca quantidade de trabalhos ou artigos detalhando o uso
 de ClickOS diante da atual demanda por NFV, até mesmo em língua inglesa,
 dificulta sua adoção, difusão, e por fim, o desenvolvimento da plataforma
 e seus conceitos por pesquisadores, professores, empresas e outros atores
 interessados, mesmo que este seja em software livre e possua uma documentação
 online, já que o conhecimento sobre ele está disperso.
\end_layout

\begin_layout Resumo
Assim sendo, este trabalho tem como objetivo apresentar detalhadamente ClickOS
 como uma alternativa para a implementação de funções de rede virtuais dentro
 de NFV, usando como cenário o balanceamento de carga em serviços de hospedagem
 
\shape italic
web
\shape default
.
\end_layout

\begin_layout Resumo
\noindent

\series bold
Palavras-chave: 
\series default
NFV; virtualização de funções de rede; VNF; função de rede virtual; middleboxes
 virtuais; Click; ClickOS.
\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Resumo
With the advent of virtualization and the Cloud Computing model arising,
 one of the fresh consequences for companies and institutions was new equipment
 acquisition reduction.
 In addition, still from an infrastructure viewpoint, decoupling functions
 that were embedded into specific and closed hardware up to higher abstraction
 layers enables a shorter deployment and maintenance time, plus a big increase
 related to scability and management of them.
\end_layout

\begin_layout Resumo
In this scenario, the NFV paradigm goals is provide network functions as:
 firewalls, load balancers, NATs, IDSes, etc, through a markup language,
 collaborating with the provisioning flexibility and programmability of
 such functions, until then also plastered by the use if shelf middleboxes.
\end_layout

\begin_layout Resumo
In this regard, ClickOS proposes a virtualization platform for high performance
 virtual network functions construction by developers.
 It provides as a tool a minimalist, scalable, and optimized virtual machine
 to run Click software in the Xen Project hypervisor, followed by some optimizat
ions focused on packet throughput.
\end_layout

\begin_layout Resumo
However, a lack of works, articles or papers detailing ClickOS use in face
 of current NFV demand, even in english language, makes it difficult to
 adopt, disseminate, and finally, the development of the platform and its
 concepts by reseachers, professors, companies and other stakeholders, even
 if it is in free software and has an online documentation, since the knowledge
 about it is dispersed.
\end_layout

\begin_layout Resumo
Thus, this work aims to present in detail ClickOS as an alternative to the
 virtual network functions implementation within NFV, using a load balancing
 scenario in web hosting services.
\end_layout

\begin_layout Resumo
\noindent

\series bold
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Abstract
\end_layout

\end_inset

Keywords:
\series default
 NFV; network functions virtualization; VNF; virtual network function; virtual
 middleboxes; Click; ClickOS.
\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset FloatList figure

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset FloatList table

\end_inset


\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

API
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Interface de Programação de Aplicação
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

ARP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Protocolo de Resolução de Endereços
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

BSS
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Sistemas de Suporte aos Negócios
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

BWM-NG
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Monitor de Largura de Banda NG
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

CAPEX
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Capital Investido
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

CSV
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Valores Separados por Vírgula
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

DHCP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Protocolo de Configuração Dinâmica de Dispositivos
 
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

DNAT
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Tradução de Endereços de Rede de Destino.
 Não confundir neste trabalho com Tradução de Endereços de Rede Dinâmicos.
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

DPDK
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Kit de Desenvolvimento em Plano de Dados da
 Intel
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

ETSI
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para o Instituto de Padronização de Telecomunicações
 Europeu
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

GNU
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo recursivo em língua inglesa para GNU não é Unix
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

HTTP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Protocolo de Transmissão de Hipertexto
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

IDS
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Sistema de Detecção de Intrusão
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

IP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Protocolo da Internet
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

KVM
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Máquina Virtual baseada em Núcleo
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

LAMP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para a junção dos nomes de Linux, Apache, MySQL
 e PHP
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

MIT
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Instituto Tecnológico de Massachussetts,
 Estados Unidos
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

MSS
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Tamanho de Segmento Máximo
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

NAT
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Tradução de Endereços de Rede
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

NEC
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Companhia Elérica Nipônica
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

NFV
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Virtualização de Funções de Rede
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

NFV MANO
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Combinação de sigla e acrônimo em língua inglesa para Orquestração e Gerenciame
nto da Virtualização de Funções de Rede
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

NFVI
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Infraestrutura de Virtualização de Funções
 de Rede
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

NIC.BR
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua portuguesa para Núcleo de Informação e Coordenação do Ponto
 BR
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

OPEX
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Despesa Operacional
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

OSI
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Interconexão de Sistemas Abertos
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

PHP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Personal Home Page
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

OSS
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Sistemas de Suporte às Operações
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

RFC
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Requisição Para Comentários
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

SDN
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Rede Definida por Software
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

SNMP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Protocolo Simples de Gerência de Rede
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

SQL
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Linguagem de Consulta Estruturada
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

SSH
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para o protocolo Shell Seguro
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

STP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Protocolo de Árvore Geradora
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

TCP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa Protocolo de Controle de Transmissão
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

UDP
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa Protocolo de Datagramas de Usuário
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

VIM
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Acrônimo em língua inglesa para Gerente de Infraestrutura Virtual
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

VM
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Máquina Virtual
\end_layout

\begin_layout Siglas
\begin_inset ERT
status open

\begin_layout Plain Layout

[
\end_layout

\end_inset

VNF
\begin_inset ERT
status open

\begin_layout Plain Layout

]
\end_layout

\end_inset

 Sigla em língua inglesa para Função de Rede Virtual
\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
tableofcontents*
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
textual
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
INTRODUÇÃO
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Verificar se o texto está de acordo com os ítens abaixo.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Os 
\shape italic
middleboxes
\shape default
 são dispositivos de propósito específico que implantam serviços ao longo
 de redes físicas, promovendo segurança, isolamento, compartilhamento, otimizaçã
o, gerenciamento, etc.
 São exemplos os 
\shape italic
switches
\shape default
, roteadores, 
\shape italic
firewalls
\shape default
, balanceadores de carga, priorizadores de pacotes, limitadores de banda,
 
\shape italic
proxies
\shape default
, filtros de conteúdo, dentre outros 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
 Durante muito tempo foram exclusivamente dispositivos de 
\shape italic
hardware
\shape default
 com 
\shape italic
software
\shape default
 embarcado, com alto custo e ciclo de vida reduzido, diante do rápido desenvolvi
mento das redes de computadores.
 No âmbito de atualizações e manutenções, não são equipamentos modulares,
 o que somado ao fim do suporte ocasiona a troca dos aparelhos, prejudicando
 o capital investido (CAPEX) e o despesa operacional (OPEX) das empresas
 usuárias.
\end_layout

\begin_layout Standard
No entanto, este modelo não está mais sozinho.
 Esforços para a construção de 
\shape italic
middleboxes
\shape default
 em 
\shape italic
hardware
\shape default
 de propósito geral já eram discutidos desde o fim da década de noventa,
 com Click 
\begin_inset CommandInset citation
LatexCommand cite
key "morris_click_1999"

\end_inset

, por exemplo.
 O início deste século trouxe o processamento em altas frequências, junto
 com a capacidade de paralelizá-lo, e mais a frente, a viabilidade da camada
 de virtualização de maneira geral, com menor perda de desempenho, grande
 eficiência energética e econômica para os investidores.
 Desta forma, os 
\shape italic
middleboxes
\shape default
 dissociados de 
\shape italic
hardware
\shape default
 se tornaram viáveis, na forma de funções de rede virtuais (VNFs) com o
 uso de tecnologias como 
\shape italic
containers
\shape default
 e paravirtualização.
\end_layout

\begin_layout Standard
Um dos padrões em desenvolvimento nesse sentido é o de Virtualização de
 Funções de Rede (NFV), que sob responsabilidade do Gerente de Infraestrutura
 Virtual (VIM) aloca recursos de um hardware de propósito geral para prover
 funções personalizadas, habilitando escalabilidade, manutenibilidade, maior
 ciclo de vida de hardware e software, e economia de recursos e investimentos.
 Justamente os pontos fracos do modelo acoplado ao hardware.
 Citado anteriormente como exemplo, Click foi um dos casos de sucesso em
 matéria de desacoplar código, sendo o equivalente da época a uma função
 de rede virtual.
 Mais de uma década depois, sua existência e vantagens se tornaram parte
 de um dos projetos de virtualização de dispositivos de rede: chama-se ClickOS
 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
\end_layout

\begin_layout Standard
ClickOS otimiza a trinca Click, Xen e MiniOS em uma plataforma integrável
 a soluções NFV 
\begin_inset CommandInset citation
LatexCommand cite
key "ventre_performance_2016"

\end_inset

 para uma fácil implementação de VNFs, com uma linguagem de marcação voltada
 para visão de fluxos, sendo de fácil legibilidade; para o provimento da
 camada de virtualização necessária, incluindo a gerência dos recursos das
 máquinas virtuais; e para prover um micro-kernel suficientemente robusto
 e pequeno para que as VNFs sejam executadas de maneira escalável com o
 devido isolamento em um ambiente de paravirtualização.
\end_layout

\begin_layout Standard
No entanto, até pela questão das disputas do nicho e pelo ainda recente
 desenvolvimento de soluções para provimento de VNFs a plataforma sofre
 com a falta de materiais didáticos, sejam em inglês ou português, mesmo
 aqueles que tratam apenas de Click, desestimulando seu uso em detrimento
 de outros semelhantes como atualmente acontece com P4 
\begin_inset CommandInset citation
LatexCommand cite
key "Bosshart:2014:PPP:2656877.2656890"

\end_inset

, que está em evidência.
 Como exemplo dessa questão, é possível citar a falta de documentações sobre:
 a integração de Click com os switches VALE 
\begin_inset CommandInset citation
LatexCommand cite
key "rizzo_vale_2012"

\end_inset

 e OpenVSwitch 
\begin_inset CommandInset citation
LatexCommand cite
key "pfaff_extending_2009"

\end_inset

 através de ClickOS; as documentações de instalação do mesmo; e a falta
 de exemplos sobre o correto uso dos elementos, exemplos implementados e
 comentados e documentação oficial incompleta.
\end_layout

\begin_layout Section
OBJETIVO
\end_layout

\begin_layout Standard
Este trabalho apresenta a plataforma para implementação de VNFs ClickOS,
 destacando sua importância e atuação dentro de NFV, entregando um rápido
 desenvolvimento e manutenção de funções, e consolidando a virtualização
 de dispositivos de redes como alternativa viável aos dispositivos físicos
 semelhantes.
\end_layout

\begin_layout Standard
Como objetivo específico, no trabalho implementa-se duas funções de rede
 virtuais em ClickOS detalhadamente, em um cenário comum ao balanceamento
 de carga em serviços de hospedagem web, e avalia a prova de conceito da
 plataforma a partir de testes.
\end_layout

\begin_layout Section
ESTRUTURA DO TRABALHO
\end_layout

\begin_layout Standard
Para além deste, o 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:CONCEITOS"

\end_inset

 trata dos conceitos principais associados ao trabalho; o 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:ENTENDENDO-CLICKOS"

\end_inset

 visa detalhar os mecanismos de ClickOS e Click para suas aplicações no
 trabalho; o 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:PROJETO-E-IMPLEMENTAÇÃO"

\end_inset

 projeta e executa a realização do objetivo específico, discorrendo sobre
 as funções de rede e o comportamento esperado, exemplificando passo a passo
 os rastros de uma comunicação dentro do cenário, destacando vantagens adquirida
s com o uso das ferramentas e plataformas; o 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:TESTES"

\end_inset

 versa sobre a realização e os resultados dos testes no cenário proposto,
 buscando confirmar a posição de ClickOS como alternativa aos dispositivos
 físicos de rede; o 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:CONCLUSÃO"

\end_inset

 caminha no sentido de analisar o esforço realizado, enfatizar pontos positivos
 e negativos da plataforma e da proposta, e encaminhar possíveis trabalhos
 futuros.
\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Chapter
CONCEITOS
\begin_inset CommandInset label
LatexCommand label
name "chap:CONCEITOS"

\end_inset


\end_layout

\begin_layout Standard
Este capítulo expõe rapidamente dois conceitos necessários para entender
 o ecossistema onde o trabalho proposto se insere.
 Na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Virtualização-de-Funções"

\end_inset

, uma rápida introdução ao contexto da Virtualização de Funções de Rede
 é exposta, com suas motivações e o caminho já trilhado que possibilita
 a discussão da virtualização de dispositivos de redes.
 Já na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Linux-Bridge"

\end_inset

, o switch virtual é posicionado dentro do cenário de virtualização, com
 o cuidado de explicar ao máximo seu mecanismo básico de uso, como insumo
 para o restante do trabalho.
\end_layout

\begin_layout Standard
Mais conceitos são tratados no 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:ENTENDENDO-CLICKOS"

\end_inset

, no entanto a riqueza de detalhes faz deste um capítulo com destaque.
\end_layout

\begin_layout Section
Virtualização de Funções de Rede 
\begin_inset CommandInset label
LatexCommand label
name "sec:Virtualização-de-Funções"

\end_inset


\end_layout

\begin_layout Standard
O modelo NFV foi proposto em 2012 por grandes empresas de telecomunicações
 em conjunto com o Instituto de Padronização de Telecomunicações Europeu
 (ETSI), tendo a redução de CAPEX e de OPEX como principal objetivo.
 Para tal, a proposta é desacoplar as funções em software dos equipamentos
 de rede hospedeiros 
\begin_inset CommandInset citation
LatexCommand cite
key "mijumbi_network_2016"

\end_inset

.
 
\end_layout

\begin_layout Standard
Para o ETSI, paradigma já possui uma arquitetura especificada, embora ainda
 não fechada ou padronizada.
 Os itens mais importantes são descritos da seguinte forma:
\end_layout

\begin_layout Itemize
Infraestrutura NFV (NFVI): combinação de recursos de hardware e software
 sobre os quais as funções de rede virtualizadas são desenvolvidas.
 As abstrações dos recursos são atingidas ao inserir uma camada de virtualização
 usando hypervisors, desacoplando então as funções de rede dos recursos
 físicos.
 Máquinas Virtuais (VMs) representam o uso de recursos de processamento
 e armazenamento, enquanto links e nós virtuais (sistemas operacionais em
 VMs) representam o uso de recursos de rede 
\begin_inset CommandInset citation
LatexCommand cite
key "mijumbi_network_2016"

\end_inset

.
 São exemplos de hypervisors o projeto Xen, KVM, HyperV, VMware vSphere,
 VirtualBox 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
ref
\end_layout

\end_inset

.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
AQUIIIIIIIIII
\end_layout

\end_inset


\end_layout

\begin_layout Itemize
Serviços e Funções de Rede Virtuais: as funções de rede são funcionalidades
 dentro de uma infraestrutura de rede com interfaces externas e comportamento
 bem definidas 
\begin_inset CommandInset citation
LatexCommand cite
key "etsi2014gs"

\end_inset

.
 Alguns exemplos mais comuns são: firewall, roteadores, balanceadores de
 carga.
 Boa parte delas também é conhecida pelo termo Middlebox 
\begin_inset CommandInset citation
LatexCommand cite
key "rfc3234"

\end_inset

.
 Já as VNFs são representações implementadas e implantadas em recursos virtuais,
 que podem conter diversos elementos internos de rede, e ser instalada em
 diversas soluções virtualizadas como VMs e containers Docker ou Linux 
\begin_inset CommandInset citation
LatexCommand cite
key "Merkel:2014:DLL:2600239.2600241"

\end_inset

, seja de forma a replicar funcionalidades ou de forma a dividir tarefas
 de uma dada função 
\begin_inset CommandInset citation
LatexCommand cite
key "mijumbi_network_2016"

\end_inset

.
 Do ponto de vista do usuário, as VNFs devem ser idênticas as funções de
 rede 
\begin_inset CommandInset citation
LatexCommand cite
key "mijumbi_network_2016"

\end_inset

, inclusive em termos de desempenho.
\end_layout

\begin_layout Itemize
Orquestração e Gerenciamento NFV (NFV MANO): funcionalidades para prover
 as VNFs e suas operações relacionadas, tais como as configurações de recursos,
 de ciclo de vida, e os comportamentos das funções virtuais, sob responsabilidad
e do VIM.
 Isso inclui a orquestração e o gerenciamento do ciclo de vida de recursos
 de software e hardware que dão suporte a virtualização.
 NFV MANO foca em tarefas especificas para gerenciamento de virtualização
 no framework NFV.
 Já o framework é responsável por definir as interfaces para comunicação
 de componentes do NFV MANO, tal qual a coordenação de sistemas tradicionais
 de gerenciamento como os Sistemas de Suporte às Operações (OSS) e os Sistemas
 de Suporte aos Negócios (BSS) 
\begin_inset CommandInset citation
LatexCommand cite
key "mijumbi_network_2016"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Inserir figura.
 De preferência, direta do ETSI
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Com a arquitetura descrita, várias implementações tiveram seu desenvolvimento
 inciado e outros núcleos de padronização como a Força-Tarefa de Engenharia
 da Internet (IETF)
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
ref
\end_layout

\end_inset

 passaram a discutir o NFV em suas especificações.
 OPNFV, OpenStack, e IETF SFC WG e o IRTF NFV RG 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
ref
\end_layout

\end_inset

são exemplos, ainda que questões técnicas e de negócios estejam abertas.
 Segundo 
\begin_inset CommandInset citation
LatexCommand cite
key "mijumbi_network_2016"

\end_inset

, algumas dessas questões são: a) controle e gerência de equipamentos legados;
 b) quais funções de rede virtuais devem ser implantadas em datacenters
 ou operadoras; c) quais devem estar dentro de VMs ou containers; d) quais
 recursos do NFVI são necessários para desenvolver uma determinada função
 virtual; e) quais os requerimentos operacionais de ambientes que operam
 VNFs e equipamentos legados.
\end_layout

\begin_layout Standard
O modelo projetado traz diversas vantagens em relação ao modelo de software
 acoplado a hardware além das economias financeiras por si só.
 A programabilidade das funções de rede permitem um desenvolvimento, manutenção
 e implantação de acordo com os anseios do cliente, de maneira mais rápida
 e estimulando um movo mercado de serviços localmente.
 Já o advento da virtualização traz a tona o uso de recursos de hardware
 sob demanda, agrupando o que antes eram diversos equipamentos com recursos
 mal utilizados em um conjunto de hardwares potentes, capaz de escalar recursos
 conforme o uso da rede se torne mais intenso, com custo mínimo para o desempenh
o.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Linux-Bridge"

\end_inset

Linux Bridge
\end_layout

\begin_layout Standard
Os dispositivos de rede chamados comutadores (switches) são resposáveis
 por conectar diversos elos de rede entre si para criar uma rede local 
\begin_inset CommandInset citation
LatexCommand cite
key "varis2012anatomy"

\end_inset

.
 O objetivo da versão virtualizada desses equipamentos é basicamente igual
 embora guarde diferenças de implementação como visto em 
\begin_inset CommandInset citation
LatexCommand cite
key "pfaff_extending_2009"

\end_inset

.
 Os switches virtuais fazem parte da nova camada de acesso de rede que ainda
 está emergindo, e provêem conectividade dentro e entre VMs, involvendo
 muitas das mesmas funções providas pelas versões físicas 
\begin_inset CommandInset citation
LatexCommand cite
key "pfaff_extending_2009"

\end_inset

.
\end_layout

\begin_layout Standard
Um dos expoentes dessa classe é o OpenVSwitch, que leva programabilidade
 para as redes ao abordar a questão de Redes Definidas por Software (SDNs).
 No entanto outros mais simples podem ser úteis em determinadas situações.
 É o caso do VALE Switch 
\begin_inset CommandInset citation
LatexCommand cite
key "rizzo_vale_2012"

\end_inset

 e do Ethernet Linux Bridge 
\begin_inset CommandInset citation
LatexCommand cite
key "varis2012anatomy"

\end_inset

, que é o switch que este trabalho faz uso.
 O Linux Bridge faz parte do kernel Linux como um módulo e é dividido de
 forma grosseira em quatro partes 
\begin_inset CommandInset citation
LatexCommand cite
key "varis2012anatomy"

\end_inset

: 
\end_layout

\begin_layout Itemize
Conjunto de portas: usado para encaminhar tráfego entre os dispositivos
 ligados a ele, sejam outros switches ou clientes finais;
\end_layout

\begin_layout Itemize
Plano de controle: usado basicamente para executar o Protocolo de Árvore
 Geradora (STP), que calcula a árvore geradora mínima para a rede local,
 prevenindo que repetições infinitas quebrem o sistema;
\end_layout

\begin_layout Itemize
Plano de encaminhamento: responsável por processar fragmentos de pacotes
 que entram pela porta de rede, fazendo uma decisão de encaminhamento sobre
 qual porta deve receber os dados;
\end_layout

\begin_layout Itemize
Aprendizado de MACs: mantém rastreado em um banco de dados ou tabela a porta
 de rede na qual o MAC está conectado, e portanto, servindo de consulta
 para encaminhar os fragmentos para seu destinatário.
 Caso o MAC não conste na tabela, o fragmento é enviado para todas as portas
 exceto a de origem.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Estrutura das interfaces virtuais de rede no Linux Bridge
\begin_inset CommandInset label
LatexCommand label
name "fig:Estrutura-das-interfaces-bridge"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/vif_bridge.png
	lyxscale 90
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Fonte: 
\begin_inset CommandInset citation
LatexCommand cite
key "noauthor_xen_nodate"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
A título de descrição, a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Estrutura-das-interfaces-bridge"

\end_inset

 retrata o conjunto de portas de um switch virtual.
 Ele possui quatro portas ocupadas, sendo duas com interfaces virtuais de
 duas VMs convidadas (vif4.0 e vif7.0), uma porta com a interface física do
 hospedeiro para comunicação externa a camada de virtualização, e por último
 uma porta conectada ao elemento de rede que identifica o switch conectado.
 Este último recebe um IP caso queira que o hospedeiro esteja conectado
 a rede dos convidados.
\end_layout

\begin_layout Standard
Dada a rede virtual criada e configurada por um assistente como o brctl
 no GNU/Linux, um conjunto de pacotes pode ser lançado da dom4 para a dom7
 através da camada de enlace.
 Dado o conjunto de portas, estes fragmentos trafegam como esperado a partir
 do momento que: o plano de controle não detecta caminhos circulares; o
 plano de encaminhamento solicita a informação sobre qual porta enviar o
 fluxo para a dom7, e recebe essa informação do plano de aprendizado de
 MACs, seja contendo em suas tabelas ou fazendo a busca.
\end_layout

\begin_layout Standard
Após realizar as configurações, a comunicação entre as duas VMs se dá da
 seguinte forma: dom4 envia fragmentos através da sua interface de rede
 de saída, entrando então na vif4.0, que por sua vez encaminha automaticamente
 em saída para o processamento dos componentes do switch citados anteriormente.
 Detectado que o destino de saída é pela porta conectada a vif7.0, o switch
 encaminha os fragmentos até a sua entrada, que por sua vez encaminha automatica
mente em saída para a interface de rede da máquina virtual.
 Um detalhe que a partir do hospedeiro é possível saber o que trafega nessa
 rede virtual, fazendo da segurança deste, primordial.
\end_layout

\begin_layout Standard
Uma das formas de anexar VMs ao switch virtual criado é através dos arquivos
 de configuração de recursos das próprias.
 No caso do Xen, com as entradas vif = [ ].
 A 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Uma-aplicação-dos"

\end_inset

 demonstra um exemplo mais concreto em seu topo, porém um exemplo simplificado
 é vif=[ 'bridge=mybridge' ], onde o Xen atribui aleatoriamente um endereço
 MAC, porém conectada ao switch virtual mybridge 
\begin_inset CommandInset citation
LatexCommand cite
key "noauthor_xen_nodate"

\end_inset

.
\end_layout

\begin_layout Standard
OBS: Favor considerar a necessidade do trecho abaixo desta seção.
 Me parece supérfulo e muito detalhista.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
ver proxima nota
\end_layout

\end_inset

São três as principais estruturas de dados que provém as funcionalidades
 necessárias para sua operação.
 A principal delas é a net_bridge, que mantém todas as informações sobre
 a cofiguração de seu switch virtual.
 Cada porta da bridge guarda dados na net_bridge_port, que contém parâmetros
 específicos sobre a porta que representa.
 Por último, a estrutura net_bridge_fdb_entry representa uma entrada na
 tabela de encaminhamento 
\begin_inset CommandInset citation
LatexCommand cite
key "varis2012anatomy"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Estrutura de dados do Linux Bridge
\begin_inset CommandInset label
LatexCommand label
name "fig:Estrutura-de-dados"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/linux_bridge_data_structure.png
	lyxscale 95
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Fonte: 
\begin_inset CommandInset citation
LatexCommand cite
key "varis2012anatomy"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Analisando a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Estrutura-de-dados"

\end_inset

, a estrutura net_bridge mantém uma referência para cada estrutura net_bridge_po
rt criada por uma porta; mantém outra referência para a interface de rede
 que ela representa; por fim, uma referência a cada tabela de encaminhamento
 existente.
 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
continuar somente se necessário
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
ENTENDENDO CLICKOS
\begin_inset CommandInset label
LatexCommand label
name "chap:ENTENDENDO-CLICKOS"

\end_inset


\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Click"

\end_inset

Click
\end_layout

\begin_layout Standard
A arquitetura Click foi idealizada por Robert Morris, Eddie Kohler e sua
 equipe do Laboratório de Ciências da Computação do Instituto Tecnológico
 de Massachusetts (MIT) em 1999, que propuseram e desenvolveram uma plataforma
 em hardware geral e em software livre, para permitir o desenvolvimento
 de funções de rede sob demanda, e sem as limitações corriqueiramente impostas
 por soluções proprietárias em redes.
 Não há restrição de camadas ou protocolos de transmissão, bastando adicionar
 seu suporte, porém o foco está na camada 2 e 3 do modelo OSI 
\begin_inset CommandInset citation
LatexCommand cite
key "day_osi_1983"

\end_inset

, com diversas operações na camada de transporte.
\end_layout

\begin_layout Standard
Click trabalha com uma unidade chamada elemento.
 Ele representa a execução de uma atividade esperada no pacote recebido
 e deve ser conectado a outros como em um grafo, permitindo o fluxo de pacotes.
 Essa junção cria uma função de rede como um firewall, balanceador de carga,
 ou qualquer outro processador de pacotes.
 Fazem parte do framework uma gama considerável de elementos pré-implementados
 pelos desenvolvedores (cerca de 300), em código aberto, e podem ser alterados
 conforme desejado desde que o editor tenha conhecimentos em C++ 
\begin_inset CommandInset citation
LatexCommand cite
key "morris_click_1999"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Descrição gráfica de um elemento em Click
\begin_inset CommandInset label
LatexCommand label
name "fig:Descrição-gráfica-de"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/click_element.png
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Fonte: 
\begin_inset CommandInset citation
LatexCommand cite
key "morris_click_1999"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Uma lista não extensa desses elementos com base na documentação do Click
 disponível 
\begin_inset CommandInset citation
LatexCommand cite
key "kohler_click:_2018"

\end_inset

:
\end_layout

\begin_layout Itemize
Ethernet: EtherEncap, EtherSwitch, EtherVLANEncap, SetEtherAddress;
\end_layout

\begin_layout Itemize
ARP: ARPQuerier, ARPResponder; ARPTable; CheckARPHeader;
\end_layout

\begin_layout Itemize
IPv4: CheckIPHeader, IPEncap, IPFragmenter, SetIPAddress, SetIPChecksum;
\end_layout

\begin_layout Itemize
IPv6: CheckIP6Header, SetIP6Address, ProtocolTranslator64, ProtocolTranslator46;
\end_layout

\begin_layout Itemize
Classificadores: Classifier, IPClassifier;
\end_layout

\begin_layout Itemize
Roteamento: StaticIPLookup, LinearIPLookup, DirectIPLookup, IPRouteTable;
\end_layout

\begin_layout Itemize
NAT: IPRewriter, ICMPRewriter, TCPRewriter, RoundRobinIPMapper, SouceIPHashMappe
r;
\end_layout

\begin_layout Itemize
Modelagem de tráfego (traffic shaping): BandwidthShaper, RatedSplitter,
 BandwidthRatedSplitter, Shaper;
\end_layout

\begin_layout Itemize
Escalonamento (scheduling): PrioSched, RoundRobinSched;
\end_layout

\begin_layout Itemize
Gerenciamento de filas: RED (Detecção Adiantada Randômica), CoDel (Controlled
 Delay);
\end_layout

\begin_layout Itemize
Redes sem Fio: WifiEncap, WifiDecap, WirelessInfo, BeaconScanner, OpenAuthReques
er;
\end_layout

\begin_layout Itemize
e demais elementos de controle, de testes e de procura de erros.
\end_layout

\begin_layout Standard
A reutilização de código é visível, porém a legibilidade é tão importante
 quanto.
 Para isso, a ferramenta dispõe de uma linguagem de entrada própria que
 esconde sua linguagem de programação base.
 Ela evidencia uma visão em grafos de fluxo, onde os elementos são nós e
 as arestas são as conexões por onde fluem os pacotes.
 Cada elemento possui especificações sobre o número de portas de entrada
 e saída, que devem ser criados e conectados no decorrer da implementação,
 no arquivo da função virtual.
 Veja a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Descrição-gráfica-de"

\end_inset

e a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Uma-aplicação-dos"

\end_inset

 para exemplos.
\end_layout

\begin_layout Standard
As portas podem ser do tipo de fluxo pull ou push, imitando a relação produtor-c
onsumidor.
 As portas pull aguardam para enviar (saída) ou requisitam para receber
 (entrada) pacotes do seu vizinho, respectivamente.
 Já as portas push não realizam esse procedimento, e portanto, os elementos
 que as utilizam devem estar sempre disponíveis para enviar e receber pacotes
 ou eles se perderão.
 Por fim, há portas chamadas agnósticas, que assumem o comportamento do
 fluxo de processamento predominante
\begin_inset CommandInset citation
LatexCommand cite
key "morris_click_1999"

\end_inset

.
 Veja a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Condicionador-de-tráfego"

\end_inset

 para uma melhor visualização.
\end_layout

\begin_layout Standard
A existência de ambos se dá pela natureza do uso de uma rede de alta velocidade
 compartilhada como as redes Ethernet 
\begin_inset CommandInset citation
LatexCommand cite
key "noauthor_ieee_2016"

\end_inset

: esvazie seu buffer de entrada o mais rápido possível para que possa continuar
 recebendo pacotes sem perdas; aguarde a sua vez para enviar a rede o mais
 rápido possível sem degradar outros pacotes.
 Logo, percebe-se que o mecanismo push compõe o recebimento e o mecanismo
 pull o envio.
 Já as filas, que são o único elemento capaz de converter o fluxo de processamen
to com portas push para aquele com portas pull, são responsáveis por armazenar
 os pacotes processados mas impedidos de irem ao buffer de saída do equipamento
 (rede bastante ocupada, com muita entrega e pouca saída de pacotes).
\end_layout

\begin_layout Standard
Ainda em relação as portas, algumas regras devem ser obedecidas: Olhando
 a partir de um elemento, uma dada saída não pode ser conectada a várias
 entradas de elementos seguintes, pois geraria efeito de duplicidade e inconsist
ência na rede; a mesma negativa se observa para as entradas do tipo pull;
 nenhum outro elemento é capaz de converter tipos de fluxo exceto as filas,
 como comentado.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Condicionador de tráfego em Click
\begin_inset CommandInset label
LatexCommand label
name "fig:Condicionador-de-tráfego"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/click_traffic_cond.png
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Fonte: 
\begin_inset CommandInset citation
LatexCommand cite
key "morris_click_1999"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Dados parâmetros do elemento classificador, os pacotes que entram nele com
 diferentes características possuem quatro caminhos: a) um chaveador de
 fluxo (Meter) que limita em no máximo 7500 pacotes por segundo despejados
 em uma fila ou descarta todos os pacotes; b) uma fila acoplada a um elemento
 limitador de fluxo (Shaper), que solicita pacotes a uma taxa de no máximo
 10000 pacotes por segundo; c) outro chaveador de fluxo com 12500 pacotes
 por segundo em outra fila, ou a passagem no elemento que marca o campo
 de serviços diferenciados do cabeçalho IP para o valor quatro antes de
 despejar em uma quarta fila; d) quarta fila aliás, que também recebe o
 fluxo que sai pela porta quatro do classificador.
 O percurso dos três primeiros caminhos terminam em um escalonador do tipo
 Round Robin 
\begin_inset CommandInset citation
LatexCommand cite
key "RASMUSSEN2008617"

\end_inset

, que após seu processamento, este ainda sofre o processamento de outro
 escalonador baseado em prioridade ordenada, onde a primeira entrada tem
 precedência sobre a seguinte.
 Ao fim, os pacotes saem pela interface escolhida no elemento de envio (ToDevice
).
\end_layout

\begin_layout Standard
Ainda sobre a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Condicionador-de-tráfego"

\end_inset

, ao passar pelas filas a coloração das portas muda, indicando a mudança
 de fluxo de processamento de push para pull e o papel das filas nesse quesito
 está representado.
 Outra observação interessante é quanto a fila do quarto caminho que recebe
 as saídas de processamento de dois elementos, evidenciando que as portas
 de entrada push, ao contrário das portas pull, podem receber fluxos de
 múltiplas saídas.
\end_layout

\begin_layout Standard
O exemplo acima possui uma visão em grafo.
 Já o presente na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Uma-aplicação-dos"

\end_inset

 demonstra através da linguagem de marcação do Click uma estrutura mínima
 para atuar sobre o protocolo IP: 
\end_layout

\begin_layout Itemize
Todos os momentos onde :: é utilizado significa uma definição de nome para
 o elemento criado.
 Toda vez que uma -> é utilizada significa uma ligação entre a porta de
 saída X e a porta de entrada Y de dois elementos;
\end_layout

\begin_layout Itemize
O AdressInfo é como um banco de dados rústico, para guardar dados sobre
 um dispositivo e usar a macro atribuída para representá-los;
\end_layout

\begin_layout Itemize
FromDevice e ToDevice fazem o recebimento e o envio de fragmentos de rede
 dos e para os buffers de rede;
\end_layout

\begin_layout Itemize
Já o Classifier classifica os pacotes com base na comparação de valores
 dos cabeçalhos, onde os dois primeiros parâmetros são códigos referentes
 aos dados do protocolo ARP 
\begin_inset CommandInset citation
LatexCommand cite
key "rfc826"

\end_inset

 (consulta e resposta, respectivamente), o terceiro parâmetro contém o código
 para os pacotes com cabeçalho IP e o quarto para todos os outros.
 A análise do cabeçalho é feita de forma que o elemento procura o código
 do cabeçalho em determinado byte, formando a sequência byte/código.
 Em caso de mais de uma sequência, a procura se torna mais específica como
 no caso do protocolo ARP;
\end_layout

\begin_layout Itemize
ARPQuerier e ARPResponder realizam o papel de preencher a tabela ARP de
 um dispositivo.
 O primeiro, diante da não existência de uma entrada para o destino solicitado
 por um pacote, consulta o equivalente ao ARPResponder de todos os dispositivos
 na rede acerca do endereço MAC, e ao receber a resposta, encapsula.
 O mesmo vale quando o portão (gateway) se torna o destinatário temporário,
 o que acontece quando o SetIPAddress é usado (detalhes no 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:PROJETO-E-IMPLEMENTAÇÃO"

\end_inset

), por exemplo.
 Como é de se imaginar, o segundo elemento responde às consultas feitas
 por outros dispositivos e pode ser utilizado para realizar Proxy ARP;
\end_layout

\begin_layout Itemize
Queue define uma fila de 200 entradas para receber os pacotes do fluxo push
 para entregar quando solicitado pelos elementos do fluxo pull;
\end_layout

\begin_layout Itemize
Conexões entre: FromDevice e o Classifier; Queue e ToDevice; as requisições
 ARP vindas do Classifier e o ARPResponder; deste último e a Queue; as respostas
 ARP vindas do Classifier e a entrada 1 do ARPQuerier; de um indicador de
 aguardo (Idle) e a entrada 0 do ARPQuerier para evitar mensagens de erro,
 e a conexão deste mesmo elemento a uma fila de tamanho 200 para escoar
 os pacotes encapsulados;
\end_layout

\begin_layout Itemize
Os pacotes IP classificados no Classifier saem pela porta 2 e então podem
 ser modificados como desejado.
 Inclusive, não é necessário inserir todos os código neste bloco, desde
 que hajam ligações deste que levem até os demais; O último elemento deve
 se conectar ao ARPQuerier para que os pacotes sejam encapsulados e enviados
 através da rede; 
\end_layout

\begin_layout Itemize
Os demais pacotes saem pela porta 3 e são descartados ao ligar tal saída
 do Classifier ao Discard.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Uma aplicação dos elementos mínimos para ações sobre o protocolo IP
\begin_inset CommandInset label
LatexCommand label
name "fig:Uma-aplicação-dos"

\end_inset

 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/clickos_arquivoBase.png
	scale 63

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Todos os elementos podem ser consultados na documentação oficial do Click
 em 
\begin_inset CommandInset citation
LatexCommand cite
key "kohler_click:_2018"

\end_inset

 para um maior entendimento de detalhes que fogem este trabalho.
 Outra fonte interessante são os livros, artigos, padronizações e textos
 técnicos sobre o uso dos protocolos de rede como por exemplo as Requisições
 Para Comentários (RFCs) do IETF.
\end_layout

\begin_layout Standard
A linguagem de marcação de Click possui um analisador que encontra erros
 de sintaxe e semântica em tempo de execução para auxilio no desenvolvimento.
 Na mesma linha, a ferramenta disponibiliza manipuladores de elementos (element
 handlers) básicos para que seja possível analisar comportamentos indesejados
 em tempo de execução.
 Um exemplo é a tabela TCP 
\begin_inset CommandInset citation
LatexCommand cite
key "rfc793"

\end_inset

 disponibilizada pelo elemento de NAT (IPRewriter), que pode indicar o correto
 funcionamento ou não de uma VNF que a utilize.
 Outros manipuladores são capazes de alterar determinadas variáveis em tempo
 de execução, mas não são muito comuns.
 De qualquer forma, Click permite a implementação de outros manipuladores
 para os elementos dado um conhecimento em C++.
 Para consultar quais manipuladores estão implementados, basta consultar
 
\begin_inset CommandInset citation
LatexCommand cite
key "kohler_click:_2018"

\end_inset

.
\end_layout

\begin_layout Standard
Outra forma de facilitar a correção de erros e também facilitar o entendimento
 de uma implementação em Click é através do uso da ferramenta de geração
 de grafos distribuída com Click chamada Clicky .
 Ela transforma o código em uma figura baseado em um arquivo de estilo CSS
 e também é capaz de analisar erros e retorná-los.
 Na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Interface-gráfica-e"

\end_inset

, pode-se ver o grafo em Clicky, representando o código descrito na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Uma-aplicação-dos"

\end_inset

, exceto o ramo da porta 2 que encontra erros e por isso é ignorado.
 Caso seja da vontade, é possível gerar figuras ou documentos contendo as
 representações.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Interface gráfica e representação gráfica padrão da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Uma-aplicação-dos"

\end_inset

 em Clicky
\begin_inset CommandInset label
LatexCommand label
name "fig:Interface-gráfica-e"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/clicky-iface.png
	scale 60

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Durante o desenvolvimento deste trabalho, algumas limitações nos elementos
 foram observadas: Para criar balanceadores de carga, os elementos existentes
 são limitados ao mecanismo de Round Robin (RoundRobinIPMapper) e distribuição
 por IP de origem (SourceIPHashMapper), sem uma análise da carga dos servidores
 que recebem o balanceamento, através do SNMP 
\begin_inset CommandInset citation
LatexCommand cite
key "rfc1157"

\end_inset

, por exemplo; a manipulação de mensagens do Protocolo de Datagrama do Usuário
 (UDP) maiores que o Tamanho de Seguimento Máximo (MSS) da camada de transporte
 é um problema quando se desenvolve um NAT em Click, já que para o recálculo
 da soma de verificação (checksum) usando o UDPChecksum, seria necessário
 remontar a mensagem UDP 
\begin_inset CommandInset citation
LatexCommand cite
key "rfc768"

\end_inset

, o que Click não disponibiliza, comprometendo o protocolo nessa situação.
 
\end_layout

\begin_layout Standard
Outra questão envolvendo estes elementos é que a tabela criada através desses
 não se apaga como deveria 
\begin_inset CommandInset citation
LatexCommand cite
key "kohler_modular_2002"

\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "kohler_click:_2018"

\end_inset

 devido a um erro de implementação que reinicia o contador responsável,
 e pode criar instabilidade quanto aos balanceamentos.
 Desta forma os balanceadores só garantem o balanceamento em tempo de criação
 da regra, e uma vez que elas permaneçam indefinidamente, determinadas conexões
 perenes podem desbalancear o sistema, já que não seriam rebalanceadas.
 Este erro foi reportado a comunidade, mas não a tempo de ser corrigido
 para este trabalho.
\end_layout

\begin_layout Standard
Click possui um módulo para operar em espaço de kernel, em substituição
 ao módulo do sistema operacional.
 Isso significa um desempenho maior em relação a sua execução em espaço
 de usuário para sistemas com essa divisão.
 É em espaço de kernel que os desenvolvedores, à época, conseguiram desempenho
 próximo ao módulo padrão do Linux
\begin_inset CommandInset citation
LatexCommand cite
key "morris_click_1999"

\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "noauthor_linux_2018"

\end_inset

.
 No entanto, atualmente o módulo do Click, encontra-se bastante defasado,
 compatibilizando com a versão do kernel Linux 2.6, em face da versão 4.16
 atual.
 Essa defasagem faz com que seu uso em um sistema operacional tradicional
 seja desestimulado, devido a complexidade em se programar para o kernel.
 Seu uso atual possui escopo em middleboxes virtualizados, como em FastClick
 
\begin_inset CommandInset citation
LatexCommand cite
key "barbette_fast_2015"

\end_inset

, ESCAPE 
\begin_inset CommandInset citation
LatexCommand cite
key "csoma_escape:_2014"

\end_inset

, CliMB 
\begin_inset CommandInset citation
LatexCommand cite
key "laufer_climb:_2016"

\end_inset

, NetBricks
\begin_inset CommandInset citation
LatexCommand cite
key "panda_netbricks:_2016"

\end_inset

, ClickOS 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

 (ver 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:ClickOS"

\end_inset

) e outros não relacionados a um kernel como o seu uso em DPDK
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Referenciar trabalhos do nerds e outros
\end_layout

\end_inset

.
 Outros usos mais diversificados são encontrados em 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Verificar quais são ligados a virtualização e quais não
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
Desde o título esta monografia se propõe a trabalhar com uma dessas aplicações
 que cresceram em torno de Click.
 ClickOS especializou uma micro máquina virtual, desenvolvendo novos elementos,
 adaptando seu micro-kernel para executar Click com seu módulo de forma
 eficiente atingindo 10Gb/s para a maioria dos tamanhos de pacotes 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:ClickOS"

\end_inset

ClickOS
\end_layout

\begin_layout Standard
ClickOS é parte de um projeto de pesquisa da Universidade politécnica de
 Bucareste junto com a Companhia Elétrica Nipônica na Europa – NEC Europe
 – para o provisionamento de VNFs que possam substituir middleboxes de hardware.
 Ele se encontra representado no modelo NFV pela camada de virtualização,
 gerenciando localmente as funções de rede virtuais.
 Trata-se primeiramente de um sistema operacional baseado em Click, focado
 em alta vazão, baixo atraso e isolamento 
\begin_inset CommandInset citation
LatexCommand cite
key "bondan_management_2014"

\end_inset

.
 Porém seus criadores objetivam também uma plataforma de alta performance
 com flexibilidade, escalabilidade e reúso de código no topo de hardwares
 de propósito geral 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
 
\end_layout

\begin_layout Standard
Para a alcunha de plataforma fazer sentido, os limites de um sistema operacional
 para micro-máquinas virtuais devem ser superados.
 ClickOS se apoia no projeto Xen e no VALE Switch 
\begin_inset CommandInset citation
LatexCommand cite
key "rizzo_vale_2012"

\end_inset

 e propõe mudanças significativas as estruturas de ambos ao inserí-los em
 sua solução.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Arquitetura inicial presente no ClickOS
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/clickos_arch.png
	scale 53

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Fonte: 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
No Xen, hypervisor de virtualização desenvolvido pela comunidade de software
 livre, várias otimizações foram realizadas segundo 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
 dentre elas, se destacam: o acesso aos pacotes recebeu uma atenção especial
 ao remover intermediários da comunicação entre as máquinas virtuais e o
 switch virtual como o driver netback, que passou a ter um papel de controle
 apenas; já o driver netfront associado as VMs foi reprogramado para colocar
 na memória de sua VMs o buffer da porta do switch; por fim, as interfaces
 virtuais do Xen (vifs) foram ignoradas e então removidas.
\end_layout

\begin_layout Standard
Já o VALE Switch, dispositivo de comutação de pacotes virtual (switch virtual)
 apresentado por Luigi Rizzo e Giuseppe Lettieri da Universidade de Pisa,
 usado para interconectar máquinas virtuais em redes a partir da API Netmap
 
\begin_inset CommandInset citation
LatexCommand cite
key "rizzo_revisiting_2012"

\end_inset

, entra na plataforma substituindo o pouco otimizado OpenVSwitch e ao fim
 é alterado para que forneça acesso direto aos buffers das portas do seu
 switch para o netfront, e para que possua mais portas, para citar as principais
 modificações
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
 Ao fim é renomeado para ClickOS Switch 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Antes e depois das alterações mencionadas
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/xen_network_io_scheme.png
	lyxscale 85
	scale 45

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
Fonte: 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
A escolha por Click para integrar a plataforma deve-se a flexibilidade e
 o reúso de código mencionados nos objetivos dos criadores e abordados na
 seção 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Click"

\end_inset

.
 ClickOS constroi seu sistema operacional a partir do MiniOS: um micro-kernel
 de sistema operacional minimalista voltado para um processamento quase
 monoprocessado, escalável, e de baixa carga de CPU, criado pelos desenvolvedore
s do projeto Xen.
 A adaptação de Click ao micro-kernel do MiniOS, inclusive portando as bibliotec
as necessárias sua construção neste sistema, resultou em um kernel enxuto,
 que dentro de uma micro-VM consume ao executar 5MB de memória, sendo instanciáv
el em 30 milissegundos, provocando um atraso na rede de 45 microssegundos,
 não necessitando de disco e alcançando uma vazão de 10Gbps 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
 Este desempenho confirma as caracteristicas atribuídas a ele no inicio
 desta seção.
\end_layout

\begin_layout Standard
Para instanciar as VNFs, ClickOS usa o método disponibilizado pelo projeto
 Xen, através de um arquivo de configuração, onde é possível descrever itens
 como quantidade de processadores, memória, interfaces virtuais de rede,
 comportamento de falhas e o nome da função virtual.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Exemplo de arquivo de configuração de uma VNF
\begin_inset CommandInset label
LatexCommand label
name "fig:Exemplo-de-arquivo-cfg"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/vnf_xen_config.png
	scale 73

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Baseando-se na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Exemplo-de-arquivo-cfg"

\end_inset

, é importante dizer que os dados sobre as redes conectadas devem estar
 de acordo com os dados atribuídos a VNF no código de Click para não haver
 enganos e erros.
 Muito cuidado ao gerar endereços MAC ou IP, pois existem classes e restrições
 em ambos
\begin_inset Note Note
status open

\begin_layout Plain Layout
referência
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
O segundo passo da criação de VNFs em ClickOS passa pelo uso do gerente
 de pilha Cosmos
\begin_inset Note Note
status open

\begin_layout Plain Layout
referência
\end_layout

\end_inset

.
 Ele recebe o código Click e a identificação da VM criada com o kernel ClickOS
 para inserir o primeiro no segundo, transformando-o em um middlebox virtual.
\end_layout

\begin_layout Standard
As VNFs não possuem linha de comandos para seu gerenciamento próprio, sendo
 esse um papel da máquina hospedeira.
 No momento da implantação das funções a partir do hospedeiro, não há passagem
 de parâmetros em tempo de inicialização.
 Apenas algumas operações de leitura e escrita em tempo de execução são
 permitidas, através dos manipuladores de elementos descritos na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Click"

\end_inset

, que podem ser acionados através do hospedeiro com o Cosmos, mas muito
 longe de ser um suporte consistente a configurações em tempo de execução
 como uma adição de regras em um firewall ou uma remoção de servidor no
 balanceador de carga.
 Para contornar essa limitação, scripts de marcação de texto podem ser utilizado
s a parte para gerar os arquivos na linguagem de Click e recarregar a função
 de rede, mesmo que signifique uma queda repentina do serviço associado.
\end_layout

\begin_layout Standard
Apesar de não possuir linha de comandos, as máquinas virtuais com o núcleo
 do ClickOS exibem um registro de alertas e erros exibido pelo comando xl
 console, que pode reportar erros de codificação de todos os níveis, erros
 de inicialização, más configurações e elementos de análise de erros para
 informar estados através deste.
\end_layout

\begin_layout Standard
Por fim, ClickOS pode trabalhar em conjunto com soluções NFV através de
 uma integração com o VIM da solução.
 São exemplos já implementados o OpenStack e o Nomad
\begin_inset CommandInset citation
LatexCommand cite
key "ventre_performance_2016"

\end_inset

.
\end_layout

\begin_layout Standard
Comandos para criação e execução, monitoramento e análise de erros estão
 no apêndice 
\begin_inset Note Note
status open

\begin_layout Plain Layout
inserir o apendice
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Chapter
PROJETO E IMPLEMENTAÇÃO 
\begin_inset CommandInset label
LatexCommand label
name "chap:PROJETO-E-IMPLEMENTAÇÃO"

\end_inset


\end_layout

\begin_layout Standard
A partir dos conceitos apresentados, este capítulo propõe, projeta e implementa
 duas funções de rede virtuais, motivado pelos benefícios da camada de virtualiz
ação no âmbito de servidores e redes com seus dispositivos.
 As características atribuídas ao ClickOS na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:ClickOS"

\end_inset

, incluíndo-se Click na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Click"

\end_inset

, pavimentam a intenção de demonstrar o desenvolvimento de VNFs de maneira
 mais clara, a partir de uma visão macro em relação àquela vista em linguagens
 de programação, sem se desenhar apenas como uma plataforma de ensino, já
 que em determinado momento é capaz de entregar desempenho satisfatório,
 inclusive sendo habilitável ao NFV.
\end_layout

\begin_layout Standard
As funções escolhidas são um firewall (
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Firewall"

\end_inset

) e um balanceador de carga (
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Balanceador-de-Carga"

\end_inset

) em uma rede com Ethernet, TCP/IP.
 A escolha se deve pela boa legibilidade e assimilação de suas funções mais
 importantes, ja que são facilmente encontrados nas infraestruturas da Tecnologi
a da Informação.
 Nesta proposta, o firewall precede o balanceador de carga sem nós intermediário
s.
 No 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:TESTES"

\end_inset

 tais funções são testados justamente em um cenário de serviço de hospedagem
 web.
\end_layout

\begin_layout Standard
Espera-se que a curva de aprendizado da ferramenta seja melhor a partir
 dessas funções do que com funções simples porém desintegradas.
 Inclusive, foge o escopo deste trabalho demonstrar VNFs complexas como
 as aplicadas hoje em middleboxes físicos, que significam recursos superestimado
s e subutilizados na maioria dos casos, o que justamente é um dos pontos
 de combate do NFV e suas funções virtuais.
 Um resumo do proposto pode ser visto na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Um-dia-dentro"

\end_inset

.
\end_layout

\begin_layout Standard
Tanto o firewall quanto o balanceador de carga possuem elementos mínimos
 para seu funcionamento, como é o caso da estrutura de camada física e de
 enlace, composta pelos elementos FromDevice, ToDevice, Classifier, ARPQuerier
 e ARPResponder (ver um uso delas na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Uma-aplicação-dos"

\end_inset

).
 Já outros como IPFilter, SetIPAddress, RoundRobinIPMapper, SourceIPHashMapper,
 IPRewriter SetTCPChecksum estão associados a tarefa de cada VNF de forma
 específica.
 Segue um detalhamento deles com base na documentação 
\begin_inset CommandInset citation
LatexCommand cite
key "kohler_click:_2018"

\end_inset

:
\end_layout

\begin_layout Itemize
IPFilter: possui uma porta de entrada por onde passam pacotes IP, e duas
 de saída por onde saem fluxos permitidos e fluxos bloqueados.
 Ao invés do último caso, há a possibilidade de ignorá-los, o que faz com
 que tal fluxo não saia pela respectiva porta.
 O que define o caminho dos pacotes são as regras adicionadas nos parâmetros
 do elemento, com base na ação descrita.
 A comparação pacote-regra é feita de forma ordenada, logo as regras mais
 específicas devem estar antes das mais genéricas.
 Em um firewall de produção, é comum que o padrão seja bloquear por padrão
 e aceitar as exceções, sendo que para reproduzir este comportamento, basta
 adicionar as regras de permissão antes da regra deny all ou drop all, ao
 fim;
\end_layout

\begin_layout Itemize
SetIPAddress: possui uma porta de entrada e outra de saída.
 É o elemento utilizado para configurar o endereço do gateway da rede, usado
 para os pacotes cujo destino está a mais de um salto a partir da rede atual.
 Quando configurado, realiza uma anotação no pacote recebido que é utilizada
 pelos elementos ARP ao encapsular o pacote IP.
 A anotação tem precedência sobre o endereço IP de destino presente no pacote
 no momento de busca pelo MAC associado na tabela ARP.
 Dessa forma, um pacote consegue saltar para as redes do gateway em busca
 do seu destino, que por sua vez pode repetir a operação sucessivamente
 até que encontre-o;
\end_layout

\begin_layout Itemize
RoundRobinIPMapper: não possui portas.
 Serve como um anexo ao IPRewriter para determinar qual regra deve ser utilizada
 no momento da reescrição de endereço IP e portas a ser feita por este.
 A determinação acontece seguindo um padrão de intervalo de tempo sem prioridade
 como é o escalonamento Round Robin.
 Ele permite que o IPRewriter tente distribuir de maneira uniforme os pacotes
 que recebe;
\end_layout

\begin_layout Itemize
SourceIPHashMapper: na mesma linha do anterior, no entanto a regra utilizada
 nesse caso depende de uma função hash para fazer a escolha dentre aquelas
 configuradas em seus parâmetros, fixando-a através do endereço IP de origem
 para que todos os pacotes provenientes do endereço tenham a mesma ação,
 independentemente de outras variáveis como endereço IP de destino ou portas;
\end_layout

\begin_layout Itemize
IPRewriter: Um dos elementos mais complexos estudados por esse trabalho,
 pode possuir quantas portas de entrada e saída for necessário.
 De forma geral, este elemento faz o papel de reescrever os cabeçalhos com
 relação aos endereços IP e portas de transporte, com base nas ações configurada
s em uma tabela pelas regras inseridas nos parâmetros do elemento.
 Estas, por sua vez, são combinadas com portas, associando uma porta de
 entrada X ao índice X na lista de parâmetros configurados no elemento.
 Caso os dados do pacote não casem com uma ação previamente estabelecida
 por outra regra, o elemento a cria e a aplica com base na regra da associação,
 atribuindo a porta de saída Y descrita na regra para o pacote alterado
 sair do elemento.
 Inclusive, o NAT costuma receber pacotes-resposta para aqueles que sofreram
 reescrição anteriormente, e por isso o IPRewriter prontamente adiciona
 uma ação de retorno para que ele também reescreva o pacote-resposta, e
 este volte ao requerente através de outra porta de saída Z do elemento,
 configurada também nos parâmetros.
 Em suma, no IPRewriter, o desenvolvedor é responsável por gerir o fluxo
 e dizer onde eles devem entrar e sair, trazendo flexibilidade para a solução.
 Além das regras de reescrição, há outras regras que permitem ações padrão
 caso não haja casamento padrão-pacote naquela porta, como ignorar o pacote
 e simplesmente passar o pacote adiante em uma porta de saída desejada,
 inclusive nas portas já existentes.
 Há também a possibilidade de usar anexos como os disponibilizados pelos
 dois elementos acima descritos, que armazenam suas regras com o mesmo padrão
 utilizado aqui.
 Para um exemplo concreto, veja a implementação do balanceador de carga
 na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Balanceador-de-Carga"

\end_inset

.
\end_layout

\begin_layout Itemize
SetTCPChecksum: com uma porta de entrada e outra de saída, este elemento
 é responsável por corrigir a soma de verificação do cabeçalho TCP, e garantir
 que os pacotes sejam considerados válidos pelas camadas de transporte que
 os recebem.
 Muito associado as saídas de um IPRewriter para validar os pacotes alterados
 por ele.
\end_layout

\begin_layout Section
Um dia dentro das funções propostas
\begin_inset CommandInset label
LatexCommand label
name "sec:Um-dia-dentro"

\end_inset


\end_layout

\begin_layout Standard
Um pacote criado por um cliente irá solicitar alguma ação para o servidor.
 Dada a abstração para que o dado chegue até o primeiro ponto de parada
 (firewall), ele chega pela rede, entra na interface virtual do switch virtual,
 que encaminha o mesmo para a interface contida na VNF.
 Nesse ponto o pacote é encaminhado para o buffer de entrada presente no
 kernel do ClickOS, que por sua vez permite que o Click receba os pacotes
 na interface de rede 0 através do elemento FromDevice.
 O elemento citado transmite o dado para o classificador (Classifier), que
 diante da análise o passa pela saída 2 ao verificar que se trata de um
 pacote Ethernet com cabeçalho IP na camada mais interna.
 Logo a frente, seu cabeçalho Ethernet é removido (Strip), seu cabeçalho
 IP é checado (CheckIPHeader), para que posteriormente possa ser analisado
 pelo elemento base do Firewall (IPFilter).
 Ao ser autorizado, o pacote inicia o caminho de saída para o próximo nó
 do cenário entrando no elemento responsável por consultar o MAC do próximo
 e encapsulá-lo (ARPQuerier), logo após chegando a fila usada para armazenar
 os pacotes enquanto o dispositivo de saída não está pronto (Queue), que
 quando o buffer de saída estiver apto, é removido de lá pelo elemento ToDevice
 enviando-o pela interface de rede 1, notabilizando uma possível rede diferente
 daquela de entrada.
 Então o pacote vai ao buffer de saída da VNF e de lá para a interface virtual
 e para o switch virtual que encaminha para a porta do próximo nó.
 Passagens: 1, 2 e parte do 3 na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Comportamento-esperado-das"

\end_inset

.
\end_layout

\begin_layout Standard
O processo se repete para a entrada do pacote no balanceador de carga até
 a etapa de checagem do endereço IP, onde ele é entregue ao elemento responsável
 pelo processo de troca de endereços de destino no DNAT (IPRewriter).
 Aqui a troca é feita conforme o elemento configurado para balancear a carga
 (SourceIPHashMapper ou RoundRobinIPMapper).
 O pacote com IP alterado para o servidor escolhido entra pela porta 0 de
 entrada e pela configuração sai pela porta 0 de saída, onde a correção
 da soma de verificação do protocolo TCP o aguarda e logo após o pacote
 sai em direção ao seu encapsulamento do cabeçalho Ethernet, repetindo o
 todo o processo de saída da VNF pela interface de rede 1, e o processo
 para sua entrega ao proximo nó.
 Passagens: parte de 3, 4 e parte do 5 na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Comportamento-esperado-das"

\end_inset

.
\end_layout

\begin_layout Standard
O próximo nó é o servidor, que assim como os outros recebe em sua interface
 de rede o pacote da interface virtual, adicionando ao buffer de entrada
 que em um momento analisa o protocolo de transporte e entrega-o de acordo
 com o serviço conectado a porta de destino definida.
 O serviço destinado analisa o pacote recebido, e supondo que seja respondível,
 o faz, o que ao fim gera um pacote resposta na rede em sentido contrário,
 que inicialmente sai do buffer de saída da interface de rede, passa pela
 interface virtual e chega ao switch virtual, que reencaminha o pacote para
 a porta onde está a interface com o balanceador de carga.
 Passagens: parte do 5, 6 e parte do 7 na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Comportamento-esperado-das"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Comportamento esperado das VNFs propostas
\begin_inset CommandInset label
LatexCommand label
name "fig:Comportamento-esperado-das"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/undergrad-thesis-fw-lbdnat.png
	lyxscale 59
	scale 29

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
No sentido contrário, o pacote resposta faz um percurso parecido que no
 sentido normal.
 As principais diferenças estão na chegada a partir da interface de rede
 1 e saída para o firewall na interface de saída 0, e no elemento de troca
 de endereços.
 Este último recebe o dado do elemento de checagem de endereços pela porta
 1 ao invés da porta 0, para que possa descartar o pacote caso não haja
 regra compatível.
 Pela regra gravada na fase de envio, o pacote resposta ao pacote original
 deve sair pela porta 1 do elemento após corretamente convertido para os
 IPs externos.
 Assim que sai pela porta 1, o pacote tem seu reprocessamento da soma de
 verificação como anteriormente, e depois recebe a anotação (SetIPAddress)
 indicando que o pacote precisa passar por um gateway no próximo nó para
 rumar ao seu destino final.
 Todo o restante do processo no balanceador de carga é comum aos passos
 já mencionados.
 Passagens: parte do 7, 8 e parte de 9 na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Comportamento-esperado-das"

\end_inset

.
\end_layout

\begin_layout Standard
Chegando ao firewall, o pacote resposta passa pelo mesmo procedimento mencionado
 no início, trocando as interfaces de rede em que entram e saem os pacotes:
 agora na porta 1 e porta 0, respectivamente.
 A partir deste ponto, retoma-se a abstração com relação a chegada do pacote
 resposta ao cliente.
 Passagens: parte do 9, 10, e 11.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Firewall"

\end_inset

Firewall
\end_layout

\begin_layout Standard
A proposta aqui passa por realizar os bloqueios no nível da camada de roteamento
 e transporte.
 O elemento de Click responsável deve avaliar a quádrupla de endereços e
 portas de origem e destino para decidir com base nas regras implantadas
 a permissão ou não para seguir fluxo, em modo sem estado (stateless).
 Dada a lista de pacotes no fluxo exibida na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "tab:Exemplo-de-fluxo-fw"

\end_inset

 e a lista de regras na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "tab:Exemplo-de-regras-fw"

\end_inset

, o resultado esperado segue na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "tab:Resultado-do-processamento-fw"

\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Exemplo de fluxo de pacotes que vai ao firewall
\begin_inset CommandInset label
LatexCommand label
name "tab:Exemplo-de-fluxo-fw"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#Pct
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
IP origem
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Porta envio
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
IP destino
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Porta alvo
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
198.51.100.55
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
443
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
443
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
198.51.100.55
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
45045
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
198.51.100.55
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
60365
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
192.0.2.237
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
53385
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22222
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22222
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
192.0.2.237
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
53385
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Exemplo de regras no firewall
\begin_inset CommandInset label
LatexCommand label
name "tab:Exemplo-de-regras-fw"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="7" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#Regra
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
IP origem
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Porta envio
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
IP destino
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Porta alvo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ação
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22222
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Aceitar
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.0/24
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1024-65536
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.0/24
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Aceitar
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.0/24
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22222
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.0/24
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1024-65536
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Aceitar
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
443
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Aceitar
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
443
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Aceitar
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Rejeitar
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Resultado do processamento no firewall
\begin_inset CommandInset label
LatexCommand label
name "tab:Resultado-do-processamento-fw"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
#Pct
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
IP origem
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Porta envio
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
IP destino
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Porta alvo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Situação
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
198.51.100.55
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
443
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ACEITO em 4
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
443
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
198.51.100.55
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
45045
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ACEITO em 5
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
198.51.100.55
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
60365
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
REJEITADO em 6
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
192.0.2.237
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
53385
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22222
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ACEITO em 1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
203.0.113.71
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22222
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
192.0.2.237
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
53385
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
REJEITADO em 6
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Os pacotes aceitos são transmitidos ao próximo nó da rede: o balanceador
 de carga.
\end_layout

\begin_layout Standard
Para que o firewall funcione de acordo com a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Um-dia-dentro"

\end_inset

, são necessárias duas interfaces de rede para diferenciar os fluxos do
 e para o mundo externo, e o fluxo do e para o balanceador de carga.
 Essa separação naturalmente exige dois conjuntos mínimos de elementos para
 tratar os pacotes na camada de enlace, respondendo e realizando requisições
 ARP, e classificando os pacotes conforme seus cabeçalhos.
 Exige também que o arquivo de configuração da máquina virtual a abrigar
 o firewall ative as placas de rede e atribua endereços IP, endereços MAC
 e os switches virtuais nos quais a interface se conecta.
\end_layout

\begin_layout Standard
Com relação a memória e processamento, as máquinas virtuais não exigem muitos
 recursos, a ponto de 12MB de memória e uma CPU virtual fazer a maioria
 das tarefas, inclusive um firewall, como demonstra 
\begin_inset CommandInset citation
LatexCommand cite
key "martins_clickos_2014"

\end_inset

.
 Em caso de problemas, ClickOS dá sinais sobre sua parada no registro de
 erros e alertas, e portanto, uma heurística pode definir melhor quais recursos
 ajustar para a função sem que haja desperdício.
 O tamanho das filas de saída de pacotes deve ser estudado.
\end_layout

\begin_layout Standard
Uma vez que os conjuntos de elementos são corretamente configurados, é preciso
 tratar os pacotes de dados.
 O uso do elemento Strip, passando o número de bytes usados pelo cabeçalho
 Ethernet para que os remova é o primeiro passo.
 Verificar a validade do cabeçalho IP extraído, para garantir que o pacote
 ainda é válido, é o segundo.
 Isto é providenciado pelo elemento CheckIPHeader, que também pode filtrar
 pacotes com base em IPs indesejados, principalmente IPs de comunicação
 abrangente (broadcasts).
 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
configurar no elemento no código.
\end_layout

\end_inset

Depois desse tratamento e checagem, é possível pensar no bloqueio e autorização
 de pacotes de maneira geral.
\end_layout

\begin_layout Standard
IPFilter, a partir de cabeçalhos, realiza filtragens de pacotes usando valores
 de endereço IP origem e destino, portas de origem e destino, e o tipo de
 protocolo de transporte, inclusive limitando pelos tipos diferentes de
 pacotes dentro destes e valores padrão de variáveis.
 As regras de autorização ou bloqueio devem ser construídas com essas bases,
 atentando-se para não limitar ou autorizar acesso em excesso.
 Para conhecimento de como as regras devem ser construídas, uma consulta
 aos elementos IPFilter e IPClassifier na documentação é essencial 
\begin_inset CommandInset citation
LatexCommand cite
key "kohler_click:_2018"

\end_inset

.
\end_layout

\begin_layout Standard
Dois filtros devem ser configurados: o primeiro trabalha no sentido de entrada
 do fluxo externo, aceitando apenas pacotes cujos cabeçalhos cumpram requisitos
 de endereço de rede IP de origem, endereço único IP de destino, número
 de porta de origem dentro de um intervalo e por fim, o número único de
 porta de destino, limitando não só os recursos e serviços acessados, como
 para quem estão disponíveis, e ignorando os demais; já o segundo trabalha
 no sentido de saída do fluxo, portanto, vindo do balanceador.
 Este aceita que apenas os pacotes-resposta retornem ao mundo externo de
 onde vieram suas requisições, e visa limitar a comunicação indesejada dos
 dispositivos balanceados, ignorando os demais pacotes e servindo de camada
 de proteção contra as invasões, principalmente.
 Uma análise de tráfego é mandatória para que nenhuma comunicação crítica
 dos dispositivos seja bloqueada nas redes envolvidas, no caso de firewall
 e balanceador em sistemas já implantados.
\end_layout

\begin_layout Standard
Uma vez que os pacotes de dados fluem pelas duas interfaces de rede, eles
 são classificados, extraídos de seus cabeçalhos Ethernet, e na sequência
 checados quanto a suas validades.
 Daí então cada fluxo entra em seu respectivo filtro e, se autorizados,
 devem se encaminhados para o reencapsulamento do cabeçalho Ethernet com
 destino ao balanceador ou ao mundo externo, sendo dispensado na respectiva
 fila e depois no respectivo elemento de saída do ClickOS correspondente
 para chegar ao seu destino.
\end_layout

\begin_layout Standard
Por fim, pacotes não classificados são descartados.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Código para o firewall em Click
\begin_inset CommandInset label
LatexCommand label
name "fig:Código-fw"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/firewall_code.png
	scale 67

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Dado o projeto descrito anteriormente, a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Código-fw"

\end_inset

 demonstra a implementação realizada e utilizada no 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:TESTES"

\end_inset

.
\end_layout

\begin_layout Standard
Da linha 2 à 5 há uma definição de macros no AddressInfo, que nos dois primeiros
 parâmetros descrevem para net0 e net1 endereços IP próprios, endereços
 IP das redes e endereços MAC respectivamente.
 Estes são os endereços atribuídos as interfaces de rede ao inserí-los nos
 elementos ARP.
 O terceiro parâmetro guarda apenas o endereço IP do balanceador de carga
 para onde são enviados os pacotes autorizados.
\end_layout

\begin_layout Standard
De 7 à 11 há a definição e declaração de dois classificadores, sendo um
 para cada rede.
 Ambos, idênticos, são definidos para filtrar pacotes de consulta do protocolo
 ARP na porta 0, pacotes de respostas do protocolo ARP na porta 1, pacotes
 do protocolo IP quaisquer na porta 2, e por fim os demais pacotes na porta
 3.
\end_layout

\begin_layout Standard
Nas linhas 13 e 14, acontece a conexão entre as entradas de pacotes das
 interfaces de rede e a porta 0 de seus respectivos classificadores.
\end_layout

\begin_layout Standard
Nas linhas 16 e 17 há a declaração e definição das duas filas necessárias
 para a conversão do fluxo push em pull no momento do despacho dos pacotes
 já filtrados, sendo uma para cada interface novamente.
 A porta 0 de saída de cada fila se conecta com a porta 0 de entrada do
 respectivo elemento de saída de pacotes à respectiva interface de rede.
\end_layout

\begin_layout Standard
Logo abaixo, na linha 19 e 20, duas novas declarações e definições são realizada
s, com o intuito de inserir o par de endereços IP e MAC de cada interface
 da VNF (net0 e net1) na respectiva tabela ARP, para quê o elemento de consulta
 desse protocolo realize o correto encapsulamento no nível da camada de
 enlace, principalmente o que diz respeito ao MAC de origem.
 Após isso, a porta de saída 0 de tais elementos é conectada a porta de
 entrada da respectiva fila.
\end_layout

\begin_layout Standard
Continuando nas linhas 22 e 23, as portas de saída 1 dos classificadores
 contém as respostas de consultas ARP, e são conectadas as portas de entrada
 1 dos respectivos elementos de consulta para que as receba corretamente
 e possa encapsular pacotes IP com o correto endereço MAC de destino consultado.
\end_layout

\begin_layout Standard
Nas linhas 25 e 26, as portas de saída 0 de ambos classificadores se conectam
 as respectivas portas de entradas 0 do elemento responsável por responder
 as consultas ARP de outros dispositivos com o correto endereço MAC para
 o endereço seu IP consultado.
 Tal elemento é responsável por atribuir o endereço IP daquela interface
 de rede na VNF, podendo responder por mais de um deles caso seja desejado.
 Perceba que os endereços configurados aqui são os mesmos que foram configurados
 nas linhas 19 e 20, para que haja não só o recebimento dos pacotes mas
 também a correta indicação ao par da comunicação de para quem enviar os
 seus.
\end_layout

\begin_layout Standard
Nas linhas 28 e 29, ocorre uma declaração e definição do elemento de filtragem
 que está relacionado a entrada do fluxo externo.
 Ele possui apenas duas regras definidas em seus parâmetros: uma para permitir
 pacotes com endereço IP de origem local à interface de rede 0, que tenham
 como endereço IP de destino o balanceador de carga, cujo número da porta
 de origem esteja entre 32768 e 61000, e a porta de destino seja a porta
 80; e outra para ignorar todos os demais pacotes que cheguem.
\end_layout

\begin_layout Standard
Com a mesma intenção, nas linhas 31 e 32 há uma declaração e definição semelhant
e a anterior, mudando apenas o foco de seu uso: a intenção agora é filtrar
 os pacotes que chegam do balanceador e que estão de saída para redes externas.
 Para isso, os endereços e números de portas que eram de origem se tornam
 de destino e vice-versa.
\end_layout

\begin_layout Standard
Entre as linhas 34 e 37, a porta de saida 2 do classificador da rede 0 entrega
 os pacotes para a extração do pacote IP no elemento, que por sua vez despacha
 os pacotes IP para o elemento de checagem do cabeçalho IP, que por sua
 vez passa os pacotes checados para o filtro de entrada, que realizando
 sua tarefa, encaminha-os para o encapsulamento da camada de enlace na rede
 1, fluindo em direção a respectiva interface de rede, onde está o balanceador
 de carga.
 Todas as portas não mencionadas, sejam de entrada ou saída, são de índice
 0.
\end_layout

\begin_layout Standard
De maneira semelhante, entre as linhas 39 e 42 o processo se repete, e os
 pacotes-resposta vindos do balanceador pela interface de rede 1, que são
 autorizados, são entregues para encapsulamento na rede 0, fluindo em direção
 a sua respectiva interface.
\end_layout

\begin_layout Standard
Por último, nas linhas 44 e 45, os pacotes que saem pela porta 3 do classificado
r entram em um elemento que determina o descarte deles.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Balanceador-de-Carga"

\end_inset

Balanceador de Carga
\end_layout

\begin_layout Standard
A proposta para esta VNF é dividir um determinado fluxo entre servidores
 de uma função semelhante, diminuindo a possibilidade de um servidor específico
 sobrecarregar ou ter vida útil reduzida, conferindo maior disponibilidade
 e durabilidade dos equipamentos.
 Podem haver duas versões, entre o método conhecido como Round Robin e o
 método por endereço IP de origem.
 O primeiro divide os pacotes para os servidores com base em um tempo de
 concessão fixo e o segundo envia todos os pacotes com um mesmo endereço
 IP de origem para o mesmo servidor destino, fazendo a seleção com base
 em uma hash.
 Ele não avalia a carga atual e a situação atual dos servidores para tomar
 as decisões, recebendo como entrada apenas o número de servidores disponibiliza
dos.
\end_layout

\begin_layout Standard
Dado 1500 pacotes emitido pelo cliente, espera-se que os servidores recebam
 os pacotes aproximadamente da seguinte forma com o método Round Robin:
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Divisão do fluxo de pacotes vindos do cliente com Round Robin
\begin_inset CommandInset label
LatexCommand label
name "tab:Exemplo-de-divisão-rr"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Dispositivo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pacotes transmitidos
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pacotes recebidos
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cliente
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Servidor 1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500/n
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Servidor 2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500/n
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Servidor n
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500/n
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Já no método por endereço IP de origem, com três diferentes clientes e 1500
 pacotes cada, espera-se que:
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Divisão do fluxo de pacotes vindos de 3 clientes com endereço IP de origem
\begin_inset CommandInset label
LatexCommand label
name "tab:Exemplo-de-divisão-sip"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="9" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Dispositivo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pacotes transmitidos
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pacotes recebidos
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cliente 1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cliente 2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cliente 3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cliente 1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cliente 1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Servidor 1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Servidor 2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1500
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Servidor 3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
-
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4500
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Para que o balanceador de carga funcione de acordo com a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Um-dia-dentro"

\end_inset

 e a 
\begin_inset CommandInset ref
LatexCommand formatted
reference "tab:Exemplo-de-divisão-rr"

\end_inset

, são necessárias duas interfaces de rede para diferenciar os fluxos originados
 e destinados ao mundo externo, dos fluxos originados e destinados aos servidore
s.
 Assim como no firewall, esta separação exige dois conjuntos mínimos de
 elementos na camada de enlace para tratar a entrada e saída na rede, gerenciar
 os pacotes de controle do protocolo ARP e separar os pacotes de acordo
 com o protocolo.
 A semelhança segue com os requisitos de memória e processamento, a correta
 configuração dos elementos mínimos e os elementos Strip de desencapsulamento
 e CheckIPHeader de checagem do protocolo IP.
\end_layout

\begin_layout Standard
Um elemento sem portas de entrada ou saída deve ser configurado para cada
 método descrito.
 Aquele que cobre o método Round Robin (RoundRobinIPMapper), deve conter
 um parâmetro para cada servidor disponível, num formato que indique qual
 a modificação para cada um dos itens dentre endereço IP de origem, número
 de porta de origem, endereço IP de destino e número de porta de destino,
 nessa ordem, sendo que os não indicados permanecem intactos.
 Após tais indicações, os parâmetros são finalizados com o informe de uma
 porta de saída do elemento para a regra criada a partir dessas indicações,
 e o informe de uma porta de saída para a regra de conversão do seu pacote-respo
sta, já em fluxo de retorno.
 Já que este elemento não possui portas, elas são alocadas no elemento de
 NAT no IPRewriter, pois a função deste é fornecer novas funcionalidades
 ao NAT disponível por Click, tal qual uma variação no momento de criação
 de suas regras.
\end_layout

\begin_layout Standard
Já o elemento para o método de balanceamento por endereço IP de origem (SouceIPH
ashMapper) precisa de mais parâmetros.
 Como trabalha com uma estrutura de tabela hash, é preciso indicar uma semente
 e um tamanho de tabela como primeiro parâmetro, e só após iniciar com os
 parâmetro de modificação de cabeçalho.
 Estes, por sua vez, possuem apenas uma modificação inserida ao final de
 cada parâmetro: um identificador para comparações na tabela.
 Assim como o elemento anterior, ele não possui portas, servindo como uma
 nova funcionalidade ao NAT no IPRewriter.
\end_layout

\begin_layout Standard
O elemento de NAT (IPRewriter) dessa proposta é simples e passa como parâmetro
 o conjunto de indicações dos elementos acima, para que sejam usados no
 caso dos pacotes de entrada de sua respectiva porta não combinarem com
 as regras existentes; e também uma outra determinação para ignorar os pacotes
 que entram por um outra porta na mesma situação.
\end_layout

\begin_layout Standard
Uma vez que os pacotes de dados fluem pelas duas interfaces de rede, eles
 são classificados, extraídos de seus cabeçalhos Ethernet, e na sequência
 checados quanto a suas validades.
 Dai então o fluxo vindo do mundo externo entra por sua porta 0 e o fluxo
 vindo dos servidores pela sua porta 1.
 A saída do primeiro fluxo, com as modificações deve acontecer pela porta
 0, e a saída do outro fluxo pela porta 1, permitindo então que a soma de
 verificação do protocolo TCP seja redefinida separadamente em ambos, através
 de elementos instanciados.
\end_layout

\begin_layout Standard
Após esse processo, os pacotes são encaminhados para o reencapsulamento
 com destino ao servidor definido pelo NAT e ao cliente, respectivamente.
 Uma observação importante é que no último caso, o destino só é alcançável
 com mais de um salto na rede, o que significa que o reencapsulamento da
 camada de enlace deve ser atribuído ao gateway da rede, no caso o próprio
 firewall, para que ele possa dar destino ao pacote.
 Um elemento deve realizar a tarefa de indicá-lo.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Código para o balanceador de carga por endereço IP de origem no Click
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/lb_code.png
	scale 65

\end_inset


\end_layout

\end_inset

As descrições para as ações programadas entre as linhas 2 e 27 são idênticas
 para aquelas feitas na implementação  da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Código-fw"

\end_inset

.
 O mesmo vale para as linhas 53 e 54.
\end_layout

\begin_layout Standard
Nas linhas de 29 à 33 há uma declaração e definição do elemento de balanceamento
 por endereço IP de origem, com seu tamanho de tabela hash e semente como
 primeiro parâmetro e nos seguintes, as modificações necessárias para cada
 servidor, a serem mapeadas no próximo elemento como regras de ida e volta.
 Pode-se ver também os identificadores ao final de cada parâmetro para efeitos
 de comparação.
\end_layout

\begin_layout Standard
No caso do elemento de balanceamento por Round Robin, as linhas descritas
 acima são substituidas pela declaração e definição do referido elemento,
 onde os parâmetros se limitam às modificações necessárias para cada servidor
 disponível, sem os identificadores naturais a tabela hash.
\end_layout

\begin_layout Standard
Nas linhas 34 à 36 acontece uma declaração e definição do elemento que reescreve
 os cabeçalhos conforme as regras determinadas pelos elementos de balanceamento.
 Ele reescreve desta forma apenas os pacotes que entram pela sua porta 0
 e não possuem um regra de reescrição anteriormente definida.
 Já os pacotes que entram pela porta 1, são ignorados caso não possuam regra
 predefinida.
\end_layout

\begin_layout Standard
Entre as linhas 38 e 44, dado que as portas não mencionadas de entrada e
 saída são portas 0, os classificadores das diferentes interfaces de rede
 enviam os pacotes IP por suas portas de saída 2, onde entram nos elementos
 de extração de cabeçalho Ethernet, saíndo direto para a entrada nos elementos
 de checagem do cabeçalho IP, e após esse processo, entram cada um em uma
 porta de entrada diferente do elemento responsável pelo NAT.
 O primeiro fluxo entra pela porta 0 e se depara com o elemento de balanceamento
, que nesse caso sorteia um servidor e executa a reescrição, enviando o
 pacote pela sua porta de saída 0.
 O segundo fluxo entra pela porta 1 e espera encontrar a regra inversa a
 alteração efetuada para que possa retornar para aquele dispositivo que
 o requisitou.
 A porta de saída nesse caso é a de número 1.
 Caso não encontrem a regra, os pacotes nessa situação são simplesmente
 ignorados.
\end_layout

\begin_layout Standard
As saídas do NAT entre as linhas 46 e 51 têm como destino o encapsulamento
 no respectivo elemento de consulta ARP.
 No caso, o encapsulamento dos pacotes que chegam de fora, é feito pelo
 elemento ARP associado a rede do balanceador, e vice versa.
 Porém antes precisam ter suas somas de verificação do protocolo TCP refeitas
 para evitar falsos erros.
 O caso dos pacotes-resposta requer um elemento que anota o endereço do
 gateway ao pacote para que o encapsulamento seja feito com ele, mesmo sem
 alterar o cabeçalho IP.
 O gateway nesse caso é indocado através do parâmetro.
\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Chapter
TESTES 
\begin_inset CommandInset label
LatexCommand label
name "chap:TESTES"

\end_inset


\end_layout

\begin_layout Standard
Dadas as implementações de firewall e balanceador de carga com DNAT, os
 testes demonstram suas validades.
 Este capítulo discorre sobre os recursos de hardware e software necessários
 para a execução dos testes (
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Infraestrutura-e-softwares"

\end_inset

 e 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Alocação-de-recursos"

\end_inset

); encaminha a configuração de um ambiente de testes com simulação em um
 serviço de hospedagem de páginas web na internet, tomando como base os
 elementos construídos no 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:PROJETO-E-IMPLEMENTAÇÃO"

\end_inset

 (
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Protótipo"

\end_inset

); e propõe os testes, descreve a execução e apresenta os resultados encontrados
, pontuando seus detalhes (
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Proposta_exec_resultados"

\end_inset

).
\end_layout

\begin_layout Section
Infraestrutura e softwares
\begin_inset CommandInset label
LatexCommand label
name "sec:Infraestrutura-e-softwares"

\end_inset


\end_layout

\begin_layout Standard
A estrutura utilizada para os testes consiste em um servidor de virtualização
 com VMware, onde uma máquina virtual com o sistema operacional Debian é
 alocada para todo o experimento.
 As especificações são:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="2">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Hospedeiro - Dell PowerEdge R820
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Máquina Virtual - dom0
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8 CPUs x Intel Xeon CPU E5-4603 @ 2.00GHz
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4 vCPUs
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
383.96 GB de RAM DDR3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6GB de RAM
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2 HDs x 2TB
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20GB de HD
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
VMware ESXi 6.5.0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Debian Server 8.7 - kernel 3.16.51-3
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Especificações de hardware para os testes
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
Como dito na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:ClickOS"

\end_inset

, ClickOS introduz uma nova camada de virtualização ao sistema que o hospeda
 através do Xen, e isso ocorre dentro de outra camada de virtualização provida
 pelo VMware, o que não parece ideal.
 Como o foco deste trabalho é a implementação, o excesso de camadas de virtualiz
ação não se mostrou um problema da maior relevância.
 Reserva-se para trabalhos futuros a otimização deste ambiente de testes
 com foco em desempenho.
\end_layout

\begin_layout Standard
Ao que se refere aos softwares instalados na máquina virtual criada pelo
 VMware, uma lista não extensiva deles é:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="10" columns="3">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tipo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Software
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Versão
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Provedor de VNFs
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ClickOS
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Hypervisor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Xen Project 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.4.1-9
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Manipulador de VNFs
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Cosmos
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Switch virtual
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Linux Bridge
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.16.51-3
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gerente do Switch
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Bridge utilities
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.5-9
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Monitor de rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
BWM-NG
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.6-3.1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Analisador de tráfego
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tcpdump
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.9.2-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Sincronizador de relógio
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ntpdate
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.2.6
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Softwares para a VM hospedeira
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
Importante mencionar que a criação do ClickOSSwitch pelos autores do ClickOS
 não exclui a possibilidade de uso de outros comutadores como o próprio
 OpenVSwitch e o Linux Bridge.
 A consequência do uso destes outros é a perda de desempenho, mas para testes
 e aplicações que não exijam desempenho prontamente, a plataforma facilita
 sua aplicação nesses ambientes.
 Este trecho é importante no contexto deste trabalho, uma vez que o foco
 é a implementação e o Linux Bridge entrega o mínimo para a troca de fluxos.
\end_layout

\begin_layout Standard
Já os softwares instalados nas máquinas virtualizadas pelo Xen que fazem
 papel de clientes (cli[1-3]) do serviço de hospedagem web são:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="8" columns="3">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tipo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Software
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Versão
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Sistema Operacional
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Debian Server
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
 8.7 - kernel 3.16.51-3
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gerador de tráfego HTTP
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Siege
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3.0.8-1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Navegador web
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Lynx
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.8.9
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Sincronizador de relógio
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ntpdate
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.2.6
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gerente de interfaces de rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ifconfig
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.60-26
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gerente de rotas de rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
route
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.60-26
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Softwares para as VMs clientes
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
Por fim, os softwares instalados nas máquinas virtualizadas pelo Xen que
 fazem o papel de servidores web (ws[1-3]) do serviço em questão são:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="3">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Tipo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Software
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Versão
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Sistema Operacional
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Debian Server
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
 8.7 - kernel 3.16.51-3
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Serviço de hospedagem web
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Apache
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Worker - 2.4.10-10
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gerente de interfaces de rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ifconfig
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.60-26
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Gerente de rotas de rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
route
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.60-26
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Softwares para as VMs servidoras
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Section
Alocação de recursos
\begin_inset CommandInset label
LatexCommand label
name "sec:Alocação-de-recursos"

\end_inset


\end_layout

\begin_layout Standard
Mesmo com as modificações feitas pelo ClickOS, o Xen ainda sim é capaz de
 entregar virtualização de máquinas com sistemas operacionais gerais como
 os GNU/Linux.
 Isso possibilita que o ambiente de teste seja todo desenvolvido em um mesmo
 local, facilitando o processo de implantação dos testes.
 Além das máquinas virtualizadas citadas na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Infraestrutura-e-softwares"

\end_inset

, aqui o Xen também virtualiza duas micro-VMs para o firewall e o balanceador
 de carga respectivamente.
 Seguem os recursos alocados para cada uma delas através de virtualização:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="2">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Recurso
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Alocado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Processador
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 CPU dedicado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Memória
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1GB dedicado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Disco
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
20GB
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Swap em disco
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1280MB alocados dinamicamente
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Recursos do hospedeiro (dom0)
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
Esta alocação dedicada retira tais recursos do total disponível para a virtualiz
ação, assim restando 5GB de memória e três CPUs das fornecidas pelo VMware
 para toda a estrutura do teste.
 Os recursos restantes são todos compartilhados com os dispositivos abaixo:
\begin_inset Tabular
<lyxtabular version="3" rows="7" columns="2">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Recurso
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Alocado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Processador
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 CPU compartilhado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Memória
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
256MB compartilhado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Disco
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6GB alocados dinamicamente
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Swap em disco
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
512MB alocados dinamicamente
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Interface de Rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2x em modo bridge
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Recursos das três VMs clientes
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Tabular
<lyxtabular version="3" rows="7" columns="2">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Recurso
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Alocado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Processador
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 CPU compartilhado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Memória
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
768MB compartilhado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Disco
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
6GB alocados dinamicamente
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Swap em disco
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
768MB alocados dinamicamente
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Interface de Rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2x em modo bridge
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Recursos das três VMs servidoras
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="2">
<features islongtable="true" longtabularalignment="center">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top" width="0pt">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Recurso
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Alocado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Processador
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1 CPU compartilhado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Memória
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
24MB compartilhado
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Interface de Rede
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2x em modo bridge
\end_layout

\end_inset
</cell>
</row>
<row endfirsthead="true" caption="true">
<cell multicolumn="1" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Recursos das duas VMs para as VNFs
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Como essa alocação é feita nos arquivos .cfg
\end_layout

\end_inset


\end_layout

\begin_layout Section
Protótipo
\begin_inset CommandInset label
LatexCommand label
name "sec:Protótipo"

\end_inset


\end_layout

\begin_layout Standard
Os recursos mencionados na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Alocação-de-recursos"

\end_inset

 foram alocados pensando em um ambiente de validação baseado em hospedagem
 web.
 Nesse ambiente é provável encontrar equipamentos que desempenham as funções
 de rede implementadas no capítulo anterior, sendo as empresas desse setor
 possíveis interessadas neste protótipo de solução virtualizada.
 No entanto, o ambiente proposto abstrai certa complexidade quando conecta
 o cliente diretamente ao firewall, sem saltos e sem que ao invés disso
 haja um dispositivo que redirecione as requisições ao mesmo.
 Mas é importante notar que esta adaptação não prejudica os testes que são
 propostos na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Proposta_exec_resultados"

\end_inset

.
 O protótipo planejado segue abaixo e esta presente no 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Colocar figura no apêndice em folha A4
\end_layout

\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/graphs/undergrad-thesis topology.png
	scale 58

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Protótipo para execução dos testes
\begin_inset CommandInset label
LatexCommand label
name "fig:Protótipo-para-execução"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Três pontes (bridges) ethernet foram criadas no switch virtual Linux Bridge
 para prover as conexões entre as máquinas virtuais, e uma entre estas e
 as demais redes físicas para fins de administração dos testes.
\end_layout

\begin_layout Standard
Após criadas e configuradas com seus softwares, as máquinas usuárias têm
 suas interfaces de rede configuradas com um IP e máscara de sub-rede usados
 para a comunicação entre VMs (198.51.100.0/24) e outro para que o controle
 das operações seja realizado de outra máquina (192.168.0.0/23) via SSH.
 Tal configuração é feita na linha de comando das VMs clientes para cada
 interface de rede usando o ifconfig, e também no arquivo de configuração
 das VMs no hospedeiro.
 Neste arquivo também se determina a qual rede do switch virtual as interfaces
 de rede virtuais das VMs estão conectadas.
 No caso do protótipo, trata-se das redes dentro das áreas amarelas na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Protótipo-para-execução"

\end_inset

 e a rede de controle que não é exibida na figura.
 Por fim, as interfaces usadas para o teste em si recebem através do route
 a informação de um gateway.
 Isto é essencial para que os pacotes cheguem até o serviço web, tendo o
 firewall como intermediário.
\end_layout

\begin_layout Standard
O firewall e o balanceador de carga recebem boa parte das suas configurações
 na fase de implementação, de modo estático, tais como IPs e máscaras de
 sub-rede como os vistos na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Protótipo-para-execução"

\end_inset

.
 Para uma melhor visualização da configuração de rede dessas VNFs, o ideal
 é consultar a 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
seção do fw no cap de implementação
\end_layout

\end_inset

e a 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
seção do lb no cap de implementação
\end_layout

\end_inset

.
 No mais, os arquivos de configuração das VMs no hospedeiro recebem as informaçõ
es sobre as redes do switch virtual usadas e as suas configurações para
 cada uma delas.
 
\end_layout

\begin_layout Standard
Idênticos aos clientes com relação a configuração de rede, os servidores
 web abdicam de interfaces de rede virtuais para seu gerenciamento, já que
 se configurados uma única vez se tornam dispositivos passivos nesse quesito,
 com modificações esporádicas e suportáveis através do hospedeiro.
 Antes de inseridos a rede local alimentada pelo balanceador de carga (172.16.0.0/1
2), seus softwares são configurados e recebem a página web que será usada
 para os testes, que possui cerca de 200 bytes.
 Trata-se de uma página HTML minimalista contendo apenas a identificação
 exclusiva de cada um dos três servidores.
 Nenhum ajuste extra foi feito no Apache Worker além do bloqueio de escrita
 de registros apenas para os testes da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:Desempenho"

\end_inset

, já que as operações estavam afetando sensivelmente a análise dos resultados.
\end_layout

\begin_layout Standard
Alguns detalhes comuns a alguns ou todos os dispositivos:
\end_layout

\begin_layout Itemize
A unidade de transporte máxima (MTU) é padronizada em 1500 bytes para todos
 do protótipo através do uso do 
\shape italic
ifconfig
\shape default
 nas interfaces de rede virtuais e nas interfaces do switch virtual;
\end_layout

\begin_layout Itemize
Os relógios dos clientes, servidores web, e hospedeiro foram sincronizados
 antes dos testes para facilitar a análise dos resultados, usando o 
\shape italic
Ntpdate
\shape default
 com o servidor b.ntp.br do NIC.BR;
\end_layout

\begin_layout Section
Proposta, execução e resultados
\begin_inset CommandInset label
LatexCommand label
name "sec:Proposta_exec_resultados"

\end_inset


\end_layout

\begin_layout Standard
Nesta seção, dois testes principais são descritos dentro do protótipo descrito
 na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:Protótipo"

\end_inset

.
 O primeiro testa a função do firewall em bloquear o acesso a determinadas
 portas, como por exemplo, a capacidade da função de rede programada de
 exercer o bloqueio ao acesso por máquinas indesejáveis.
 De forma idêntica, o segundo testa a função do balanceador de carga em
 dividir o fluxo de entrada entre vários servidores com base no endereço
 IP e na nº da porta de origem do pacote.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Reescrever
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Firewall
\begin_inset CommandInset label
LatexCommand label
name "subsec:Firewall"

\end_inset


\end_layout

\begin_layout Standard
Usando o Siege a partir de um cliente qualquer da rede, emite-se tráfego
 tendo como destino a borda do serviço de hospedagem como na figura 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Protótipo-para-execução"

\end_inset

.
 O tráfego HTTP gerado passa obrigatoriamente pelo firewall, permitindo
 uma análise detalhada do fluxo, realizando concessões e bloqueios conforme
 a proposta.
 
\end_layout

\begin_layout Standard
As decisões tomadas pela função afetam a execução do Siege.
 Para monitorá-las, aplica-se o BWM-NG nas interfaces virtuais relacionadas
 ao firewall e ao cliente em questão, a procura de padrões que demonstrem
 o comportamento do fluxo.
 Não trafegam quaisquer outras conexões pelas interfaces testadas.
\end_layout

\begin_layout Standard
Para a execução, executa-se os softwares em paralelo e sincronizadamente,
 com o Siege no cliente e o BWM-NG no hospedeiro da plataforma ClickOS.
 O primeiro é configurado para uma execução em no máximo quinze segundos
 com cem processos concorrentes emitindo requisições para http://192.0.2.61:X/index
2.html, onde X é o número da porta a ser acessada.
 Já o segundo guarda uma leitura do fluxo dos pacotes a cada meio segundo
 nas interfaces selecionadas, de acordo com padrão CSV.
\end_layout

\begin_layout Standard
Para auxílio na geração dos gráficos e análise dos resultados, os arquivos
 resultantes de ambos comandos armazenam os segundos do relógio do sistema.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tfw/p80_pctsOUTGOING.png
	lyxscale 95
	scale 54

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tfw/p80_pctsINCOMING.png
	lyxscale 95
	scale 54

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Fluxo de pacotes TCP 80 com foco no firewall
\begin_inset CommandInset label
LatexCommand label
name "fig:Fluxo-de-pacotes-fw-80"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tfw/p8080_pctsOUTGOING.png
	lyxscale 95
	scale 54

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tfw/p8080_pctsINCOMING.png
	lyxscale 95
	scale 54

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Fluxo de pacotes TCP 8080 com foco no firewall
\begin_inset CommandInset label
LatexCommand label
name "fig:Fluxo-de-pacotes-fw-8080"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Para tornar os gráficos mais limpos, foram excluídas as representações dos
 clientes não utilizados no momento da execução.
\end_layout

\begin_layout Standard
Como se pode observar na parte superior da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Fluxo-de-pacotes-fw-80"

\end_inset

, o cliente configurado para enviar o fluxo de requisições através da porta
 TCP 80 possui um padrão condizente com o esperado em uma conexão normal,
 respeitando o controle de fluxo nativo do protocolo de transporte em questão,
 e sem perdas significantes.
 O tráfego gerado por ele é notado nas interfaces de entrada e de saída
 do firewall, demonstrando aceitação deste pelas regras.
 No outro sentido do tráfego e na parte inferior da figura, as respostas
 mantêm proporções semelhantes se comparadas ao gráfico de envio, salvo
 variações mínimas nas quantidades a serem interpretadas como naturais ao
 procedimento de medição, e demonstrando inexistência de condições adversas.
\end_layout

\begin_layout Standard
Já o cliente configurado para enviar requisições HTTP pela porta TCP 8080,
 na parte superior da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Fluxo-de-pacotes-fw-8080"

\end_inset

, demonstra problemas para utilizar o protocolo para estabelecer transporte
 para o servidor web, enviando apenas cem pacotes de sincronia em intervalos
 de tempo binários, e que não aparecem na interface virtual de saída do
 firewall, sendo então bloqueados pela função de rede virtual.
 Este número não é em vão, já que são cem os processos concorrentes que
 requisitam conexões com o serviço.
 Se o fluxo de saída não chega ao serviço, logo é improvável que seja haja
 resposta em forma de tráfego de entrada representado na parte inferior,
 o que de fato não ocorre exceto por um único pacote, que por exclusão,
 é uma resposta ARP do próprio firewall a uma requisição do cliente (veja
 no segundo seis de ambos gráficos).
 Importante lembrar que este firewall trabalha apenas com filtragem de pacotes
 IP e não responde pelos pacotes ARP, que seguem outros fluxos na árvore
 de execução do Click como visto na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Uma-aplicação-dos"

\end_inset

.
\end_layout

\begin_layout Subsection
Balanceador de carga por endereço IP de origem
\begin_inset CommandInset label
LatexCommand label
name "subsec:Balanceador-de-carga-sip"

\end_inset


\end_layout

\begin_layout Standard
Neste teste, três clientes emitem fluxos para a borda do serviço de hospedagem
 duas vezes cada, de forma que as emissões não se sobrepõem.
 O tráfego gerado passa obrigatoriamente pelo firewall, e uma vez filtrado
 chega ao balanceador, que o distribui aos servidores web configurados na
 VNF através da aplicação de um DNAT.
\end_layout

\begin_layout Standard
Novamente o BWM-NG é usado para monitorar as interfaces virtuais relacionadas
 ao cliente e aos servidores, que são respectivamente origem e destino dos
 pacotes, a procura de padrões que demonstrem o comportamento do fluxo.
 Não existem quaisquer outras conexões vigentes no ambiente de teste.
\end_layout

\begin_layout Standard
A execução é feita em sequência, partindo do primeiro cliente ao terceiro,
 duas vezes.
 São seis execuções sequenciais e alternadas de no máximo quinze segundos
 cada para http://192.0.2.61:80/index2.html, gerando o arquivo CSV, e armazenando
 os segundos do relógio do sistema para auxílio na geração dos gráficos
 e análise dos resultados.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Fluxo de pacotes no balanceador de carga por endereço IP
\begin_inset CommandInset label
LatexCommand label
name "fig:Fluxo-de-pacotes-lb-sip"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tnatlb_sip/p80_pctsOUTGOING.png
	lyxscale 95
	scale 54

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /home/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tnatlb_sip/p80_pctsINCOMING.png
	lyxscale 95
	scale 54

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Nos gráficos da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Fluxo-de-pacotes-lb-sip"

\end_inset

o primeiro, acima, demonstra a saída dos pacotes dos clientes e a chegada
 deles nos servidores web e o segundo, abaixo, demonstra o caminho contrário,
 onde os pacotes-resposta retornam do servidor para o cliente.
 Em todos os seis momentos do primeiro gráfico há um cliente enviando e
 seus pacotes chegando a um único servidor, inclusive mantendo a relação
 cliente servidor definida nas segundas tentativas.
 Cada cliente foi balanceado para um servidor diferente, embora nesse caso
 não seja um resultado ruim que dois deles fossem encaminhados para o mesmo
 servidor, já que o elemento não analisa o estado atual dos nós balanceadores.
 Claro que ao se tratar de uma conexão TCP, os pacotes-resposta também precisam
 retornar corretamente para que não haja uma queda na transmissão por parte
 do cliente, o que acontece e valida o bom funcionamento da VNF.
\end_layout

\begin_layout Subsection
Balanceador de carga por Round Robin
\begin_inset CommandInset label
LatexCommand label
name "subsec:Balanceador-de-carga-rr"

\end_inset


\end_layout

\begin_layout Standard
O Siege emite o mesmo tipo de fluxo do firewall partir de um cliente para
 a borda do serviço de hospedagem.
 O tráfego HTTP na porta 80 passa obrigatoriamente pelo firewall, e uma
 vez filtrado chega ao balanceador de carga, que o distribui aos servidores
 web configurados na VNF, através da aplicação de um DNAT.
\end_layout

\begin_layout Standard
O BWM-NG é usado novamente para monitorar as interfaces virtuais relacionadas
 ao cliente e aos servidores web, que são origem e destino dos pacotes,
 a procura de padrões que demonstrem o comportamento do fluxo.
 Não trafegam quaisquer outras conexões pelas interfaces testadas.
\end_layout

\begin_layout Standard
A execução ocorre de forma parecida com a do teste anterior, porém sem a
 necessidade de múltiplas execuções.
 Desta forma, apenas um cliente é necessário.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tnatlb_rr/p80_pctsOUTGOING.png
	lyxscale 47
	scale 54

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tnatlb_rr/p80_pctsINCOMING.png
	lyxscale 47
	scale 54

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Fluxo de pacotes no balanceador de carga por Round Robin
\begin_inset CommandInset label
LatexCommand label
name "fig:Fluxo-de-pacotes-lb-rr"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Na parte superior da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Fluxo-de-pacotes-lb-rr"

\end_inset

, está o fluxo de pacotes enviados pelo cliente.
 Observa-se uma semelhança entre as quantidades de pacotes enviados pelo
 cliente e recebidos por todos os servidores.
 Os servidores web recebem individualmente cerca de um terço do total de
 pacotes, como é possível ver nas três linhas que os representam, praticamente
 sobrepostas, e corroboram com a expectativa despejada em cima do balanceador
 de carga desenvolvido.
\end_layout

\begin_layout Standard
Na parte inferior da figura está o fluxo de pacotes recebido pelo cliente,
 vindo dos servidores, e em resposta as requisições HTTP.
 Este gráfico se assemelha ao anterior em suas linhas e nas quantidades
 de pacotes enviados a cada intervalo, o que é de se esperar de uma rede
 neutra, e demonstrando que o teste não sofreu reações adversas, tampouco
 alta carga de processamento com os parâmetros usados.
\end_layout

\begin_layout Standard
Para tornar os gráficos mais limpos, foram excluídas as representações dos
 clientes não utilizados no momento da execução.
\end_layout

\begin_layout Subsection
Desempenho
\begin_inset CommandInset label
LatexCommand label
name "subsec:Desempenho"

\end_inset


\end_layout

\begin_layout Standard
Embora o desempenho não seja primordial para este trabalho, é possível fazer
 algumas análises sobre a adição de ClickOS ao ambiente virtualizado, mesmo
 com uma camada extra de virtualização.
 A intenção é analisar o tráfego, os erros e o tempo de resposta médio do
 protótipo e de seus recortes, onde as VNFs são retiradas gradativamente
 começando pelo balanceador, passando pelo firewall e assim chegando a uma
 conexão direta entre cliente e servidor.
\end_layout

\begin_layout Standard
Apenas o Siege é utilizado, já que em seu relatório indica os dados necessários
 e com a facilidade do formato CSV.
 Ele é configurado para enviar pacotes por sessenta segundos aos endereços,
 que por sua vez variam de acordo com o recorte do protótipo.
 Outra variável é o número de usuários concorrentes em cada máquina cliente.
 Durante os pré-testes, verificou-se uma limitação de mil usuários simultâneos
 para cada cliente, e números acima deste causam vazamentos de memória nas
 máquinas.
 Dado que o cenário é todo virtualizado, optou-se por manter três clientes
 ao invés de buscar mais recursos e clientes com novas VMs.
\end_layout

\begin_layout Standard
Para gerar uma amostragem, um passo de cem clientes foi escolhido, totalizando
 dez execuções crescentes para o protótipo e os recortes.
 Uma pausa de cinco minutos é dada entre uma execução de amostra e outra,
 totalizando cerca de sessenta minutos de execução para cada situação testada,
 para eliminar qualquer conexão ainda estabelecida nos servidores web que
 estejam aguardando resposta, e portanto ocupando-o.
\end_layout

\begin_layout Standard
Dessa forma, os gráficos representam quatro situações: com balanceador Round
 Robin, com balanceador por endereço IP de origem, apenas com o firewall,
 e sem VNFs.
 Todas foram medidas separadamente, de forma que as interferências inerentes
 ao processamento compartilhado das máquinas e do ambiente de virtualização
 podem afetar uma mas não a outra.
 Uma tentativa de minimizar este problema reside em anular o registro de
 acessos e erros do Apache Worker no caso do processamento nas máquinas,
 e restringir o uso das máquinas virtuais em meio aos testes, inclusive
 fazendo os testes durante horários de pouca carga no ambiente do VMware.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tclickos_stress/transacoes.png
	scale 65

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Média de transações por segundo de acordo com o número de usuários
\begin_inset CommandInset label
LatexCommand label
name "fig:Média-de-transações"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Média-de-transações"

\end_inset

, fica clara a influência das VNFs na quantidade de transações efetuadas.
 É de se esperar que uma ligação direta entre as VMs clientes e as servidoras
 traga melhores resultados; que logo em seguida viria o desempenho de um
 elemento que, neste trabalho, é considerado somente leitura, adicionando
 mais um nó na comunicação cliente-servidor; e por último, também adicionando
 mais um nó, estariam os balanceadores de carga, que efetuam altas cargas
 de escrita e afetam o tempo de resposta como demonstrado na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Tempo-médio-de"

\end_inset

.
\end_layout

\begin_layout Standard
Entre os balanceadores cabe analisar a eficiência de cada um deles dentro
 do protótipo.
 Essencialmente, o IPRewriter realiza quatro operações de escrita nos pacotes
 associados a uma transação, independente do método de balanceamento: as
 alterações de cabeçalho IP, e o recálculo da soma de verificação TCP, em
 cada sentido.
 A adição dessas operações ao sistema trazem os benefícios desejados, mas
 também uma queda de desempenho notável, aliada a uma falha de implementação
 que impede as regras com conexões finalizadas sejam eliminadas da tabela
 de regras, causando nesta um crescimento proporcional ao fluxo de entrada,
 e tornando sua consulta cada vez mais lenta até que o balanceador seja
 reiniciado.
\end_layout

\begin_layout Standard

\series bold
OBS: Favor ignorar daqui pra frente
\end_layout

\begin_layout Standard
Com os dados gerados dos vários pré-testes, não foi possível atribuir diferença
 significativa de desempenho entre os métodos de balanceamento, e portanto,
 qualquer avaliação dos códigos de ambos não faz efeito.
 A alta variação da média de transações do balanceamento por IP de origem
 não encontra explicações nos estudos feitos feitos sobre a ferramenta,
 e passa a assumir questões da carga do sistema como um todo.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tclickos_stress/erros.png
	scale 65

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Números absolutos de erros de acordo com o número de usuários
\begin_inset CommandInset label
LatexCommand label
name "fig:Números-absolutos-de"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Nesta parte do teste, é preciso diferenciar os dois principais tipos de
 erros que acontecem.
 O primeiro é o erro de tempo limite atingido, que cancela uma conexão dado
 uma ausência de pacotes de dados ou de controle trocados em determinado
 tempo.
 O Siege configura um tempo limite de trinta segundos para estabelecimento
 de conexão e quando atingido libera o usuário para uma nova tentativa.
 Já o Apache, configura vários destes no âmbito de dados, podendo o tempo
 variar de vinte a sessenta segundos por padrão.
 Já o segundo trata-se de uma conexão reiniciada pelo par, que pode acontecer
 tanto da parte do cliente quanto do servidor...
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
Continuar
\end_layout

\end_inset


\end_layout

\begin_layout Standard
A grande parte dos erros apresentados para as execuções sem balanceador
 são do tipo tempo limite atingido, onde o servidor web reporta com o código
 408 o fim do tempo de espera para o recebimento de algum pacote de dados.
 No caso das execuções com o balanceador, o tipo predominante de erro é
 o de conexão reiniciada.
 É de se esperar que o número de erros fosse de uma grandeza próxima na
 primeira situação devido a exclusiva leitura do firewall, e que crescesse
 na segunda situação devido as operações de escrita, mas a mudança no tipo
 de erro merece atenção.
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Qual a justificativa associada a escrita dos pacotes para essa mudança?
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename /media/Dados/felipe/Área de trabalho/undergraduate-thesis/thesis/docs/results/tclickos_stress/tempo_de_resposta.png
	scale 65

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Tempo médio de resposta de acordo com o número de usuários
\begin_inset CommandInset label
LatexCommand label
name "fig:Tempo-médio-de"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
O tempo de resposta na 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Tempo-médio-de"

\end_inset

 acompanha quase que rigorosamente o comportamento da média da taxa de transaçõe
s da 
\begin_inset CommandInset ref
LatexCommand formatted
reference "fig:Média-de-transações"

\end_inset

.
 
\begin_inset Note Note
status open

\begin_layout Plain Layout
continuar
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Chapter
CONCLUSÃO 
\begin_inset CommandInset label
LatexCommand label
name "chap:CONCLUSÃO"

\end_inset


\end_layout

\begin_layout Standard
Reafirmar a porra toda
\end_layout

\begin_layout Standard
\begin_inset Newpage cleardoublepage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "thesis"
options "bibtotoc,abntex2-num"

\end_inset


\end_layout

\begin_layout Standard

\end_layout

\end_body
\end_document
